<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å¾®æœåŠ¡æ¶æ„è®¾è®¡åŸç†ä¸æœ€ä½³å®è·µ</title>
      <link href="/2025/11/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E7%90%86%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
      <url>/2025/11/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E7%90%86%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="å¾®æœåŠ¡æ¶æ„è®¾è®¡åŸç†ä¸æœ€ä½³å®è·µ"><a href="#å¾®æœåŠ¡æ¶æ„è®¾è®¡åŸç†ä¸æœ€ä½³å®è·µ" class="headerlink" title="å¾®æœåŠ¡æ¶æ„è®¾è®¡åŸç†ä¸æœ€ä½³å®è·µ"></a>å¾®æœåŠ¡æ¶æ„è®¾è®¡åŸç†ä¸æœ€ä½³å®è·µ</h1><blockquote><p>ğŸš€ <strong>æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥äº†è§£</strong></p><ul><li>å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒç†å¿µå’Œä¼˜åŠ¿</li><li>ä»å•ä½“åº”ç”¨å‘å¾®æœåŠ¡çš„æ¸è¿›å¼è¿ç§»ç­–ç•¥</li><li>Spring Cloudç”Ÿæ€ç³»ç»Ÿå®Œæ•´è§£å†³æ–¹æ¡ˆ</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çš„å…³é”®è€ƒé‡ç‚¹</li><li>ç”Ÿäº§ç¯å¢ƒä¸‹çš„å¾®æœåŠ¡æ²»ç†å®è·µ</li></ul></blockquote><h2 id="ğŸ“š-ç›®å½•æ¦‚è§ˆ"><a href="#ğŸ“š-ç›®å½•æ¦‚è§ˆ" class="headerlink" title="ğŸ“š ç›®å½•æ¦‚è§ˆ"></a>ğŸ“š ç›®å½•æ¦‚è§ˆ</h2><ul><li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84">ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„</a></li><li><a href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1vs%E5%8D%95%E4%BD%93%E5%BA%94%E7%94%A8%E5%AF%B9%E6%AF%94">å¾®æœåŠ¡vså•ä½“åº”ç”¨å¯¹æ¯”</a></li><li><a href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99">å¾®æœåŠ¡è®¾è®¡åŸåˆ™</a></li><li><a href="#%E6%8A%80%E6%9C%AF%E6%A0%88%E9%80%89%E5%9E%8B%E6%8C%87%E5%8D%97">æŠ€æœ¯æ ˆé€‰å‹æŒ‡å—</a></li><li><a href="#%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B">å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†ç³»ç»Ÿå¾®æœåŠ¡åŒ–</a></li><li><a href="#%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ</a></li></ul><h2 id="ğŸ¯-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„"><a href="#ğŸ¯-ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„" class="headerlink" title="ğŸ¯ ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„"></a>ğŸ¯ ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„</h2><p>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€ç§<strong>åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡æ–¹æ³•</strong>ï¼Œå®ƒå°†å•ä¸€åº”ç”¨ç¨‹åºå¼€å‘ä¸ºä¸€å¥—å°å‹æœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨è‡ªå·±çš„è¿›ç¨‹ä¸­ï¼Œå¹¶ä½¿ç”¨è½»é‡çº§æœºåˆ¶ï¼ˆé€šå¸¸æ˜¯HTTPèµ„æºAPIï¼‰è¿›è¡Œé€šä¿¡ã€‚</p><h3 id="æ ¸å¿ƒç‰¹å¾"><a href="#æ ¸å¿ƒç‰¹å¾" class="headerlink" title="æ ¸å¿ƒç‰¹å¾"></a>æ ¸å¿ƒç‰¹å¾</h3><pre class="mermaid">graph TB    A[å¾®æœåŠ¡æ¶æ„] --> B[æœåŠ¡ç‹¬ç«‹éƒ¨ç½²]    A --> C[ä¸šåŠ¡åŠŸèƒ½å•ä¸€]    A --> D[å»ä¸­å¿ƒåŒ–æ²»ç†]    A --> E[æ•…éšœéš”ç¦»]    A --> F[æŠ€æœ¯å¤šæ ·æ€§]        B --> B1[ç‹¬ç«‹å‘å¸ƒå‘¨æœŸ]    B --> B2[ç‹¬ç«‹æ‰©ç¼©å®¹]        C --> C1[å•ä¸€èŒè´£åŸåˆ™]    C --> C2[é«˜å†…èšä½è€¦åˆ]        D --> D1[æ•°æ®åº“åˆ†ç¦»]    D --> D2[å›¢é˜Ÿè‡ªæ²»]        E --> E1[æœåŠ¡ç†”æ–­]    E --> E2[é™çº§ç­–ç•¥]        F --> F1[è¯­è¨€æ— å…³]    F --> F2[æ¡†æ¶é€‰æ‹©è‡ªç”±]</pre><h2 id="âš–ï¸-å¾®æœåŠ¡vså•ä½“åº”ç”¨å¯¹æ¯”"><a href="#âš–ï¸-å¾®æœåŠ¡vså•ä½“åº”ç”¨å¯¹æ¯”" class="headerlink" title="âš–ï¸ å¾®æœåŠ¡vså•ä½“åº”ç”¨å¯¹æ¯”"></a>âš–ï¸ å¾®æœåŠ¡vså•ä½“åº”ç”¨å¯¹æ¯”</h2><table><thead><tr><th>ç»´åº¦</th><th>å•ä½“åº”ç”¨</th><th>å¾®æœåŠ¡æ¶æ„</th></tr></thead><tbody><tr><td><strong>å¼€å‘å¤æ‚åº¦</strong></td><td>ğŸŸ¢ ç®€å•</td><td>ğŸŸ¡ å¤æ‚</td></tr><tr><td><strong>éƒ¨ç½²æ–¹å¼</strong></td><td>ğŸŸ¢ ç®€å•</td><td>ğŸŸ¡ å¤æ‚</td></tr><tr><td><strong>æŠ€æœ¯æ ˆ</strong></td><td>ğŸŸ¡ ç»Ÿä¸€</td><td>ğŸŸ¢ å¤šæ ·åŒ–</td></tr><tr><td><strong>æ‰©å±•æ€§</strong></td><td>ğŸ”´ æ•´ä½“æ‰©å±•</td><td>ğŸŸ¢ æŒ‰éœ€æ‰©å±•</td></tr><tr><td><strong>æ•…éšœå½±å“</strong></td><td>ğŸ”´ å…¨å±€å½±å“</td><td>ğŸŸ¢ å±€éƒ¨éš”ç¦»</td></tr><tr><td><strong>å›¢é˜Ÿåä½œ</strong></td><td>ğŸŸ¡ éœ€è¦åè°ƒ</td><td>ğŸŸ¢ ç‹¬ç«‹å¼€å‘</td></tr><tr><td><strong>æ•°æ®ä¸€è‡´æ€§</strong></td><td>ğŸŸ¢ ACIDäº‹åŠ¡</td><td>ğŸ”´ æœ€ç»ˆä¸€è‡´æ€§</td></tr></tbody></table><h2 id="ğŸ—ï¸-å¾®æœåŠ¡è®¾è®¡åŸåˆ™"><a href="#ğŸ—ï¸-å¾®æœåŠ¡è®¾è®¡åŸåˆ™" class="headerlink" title="ğŸ—ï¸ å¾®æœåŠ¡è®¾è®¡åŸåˆ™"></a>ğŸ—ï¸ å¾®æœåŠ¡è®¾è®¡åŸåˆ™</h2><h3 id="1-å•ä¸€èŒè´£åŸåˆ™-Single-Responsibility-Principle"><a href="#1-å•ä¸€èŒè´£åŸåˆ™-Single-Responsibility-Principle" class="headerlink" title="1. å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility Principle)"></a>1. å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility Principle)</h3><p>æ¯ä¸ªå¾®æœåŠ¡åº”è¯¥ä¸“æ³¨äºä¸€ä¸ªä¸šåŠ¡èƒ½åŠ›ï¼Œéµå¾ªâ€åšä¸€ä»¶äº‹å¹¶åšå¥½â€çš„åŸåˆ™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ ä¸å¥½çš„è®¾è®¡ - èŒè´£æ··ä¹±</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserManagementService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(User user)</span> &#123; <span class="comment">/* ç”¨æˆ·åˆ›å»º */</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmail</span><span class="params">(String email)</span> &#123; <span class="comment">/* é‚®ä»¶å‘é€ */</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">generateReport</span><span class="params">()</span> &#123; <span class="comment">/* æŠ¥è¡¨ç”Ÿæˆ */</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processPayment</span><span class="params">(Payment payment)</span> &#123; <span class="comment">/* æ”¯ä»˜å¤„ç† */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… å¥½çš„è®¾è®¡ - èŒè´£å•ä¸€</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createUser</span><span class="params">(User user)</span> &#123; <span class="comment">/* ä¸“æ³¨ç”¨æˆ·ç®¡ç† */</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123; <span class="comment">/* */</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUser</span><span class="params">(Long id)</span> &#123; <span class="comment">/* */</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NotificationService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendEmail</span><span class="params">(String email)</span> &#123; <span class="comment">/* ä¸“æ³¨é€šçŸ¥æœåŠ¡ */</span> &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendSms</span><span class="params">(String phone)</span> &#123; <span class="comment">/* */</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æ•°æ®åº“åˆ†ç¦»åŸåˆ™"><a href="#2-æ•°æ®åº“åˆ†ç¦»åŸåˆ™" class="headerlink" title="2. æ•°æ®åº“åˆ†ç¦»åŸåˆ™"></a>2. æ•°æ®åº“åˆ†ç¦»åŸåˆ™</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®å­˜å‚¨</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">user-service:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">user_db</span></span><br><span class="line">    <span class="attr">technology:</span> <span class="string">PostgreSQL</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">order-service:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">order_db</span></span><br><span class="line">    <span class="attr">technology:</span> <span class="string">MySQL</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">product-service:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">product_db</span></span><br><span class="line">    <span class="attr">technology:</span> <span class="string">MongoDB</span></span><br><span class="line">    </span><br><span class="line">  <span class="attr">analytics-service:</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">analytics_db</span></span><br><span class="line">    <span class="attr">technology:</span> <span class="string">Elasticsearch</span></span><br></pre></td></tr></table></figure><h3 id="3-æ— çŠ¶æ€è®¾è®¡"><a href="#3-æ— çŠ¶æ€è®¾è®¡" class="headerlink" title="3. æ— çŠ¶æ€è®¾è®¡"></a>3. æ— çŠ¶æ€è®¾è®¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âœ… æ— çŠ¶æ€è®¾è®¡ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/orders&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Order&gt; <span class="title function_">createOrder</span><span class="params">(<span class="meta">@RequestBody</span> CreateOrderRequest request, </span></span><br><span class="line"><span class="params">                                           <span class="meta">@RequestHeader(&quot;Authorization&quot;)</span> String token)</span> &#123;</span><br><span class="line">        <span class="comment">// ä»tokenè§£æç”¨æˆ·ä¿¡æ¯ï¼Œä¸ä¾èµ–sessionçŠ¶æ€</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> jwtTokenUtil.parseUser(token);</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderService.createOrder(request, user);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(order);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ› ï¸-æŠ€æœ¯æ ˆé€‰å‹æŒ‡å—"><a href="#ğŸ› ï¸-æŠ€æœ¯æ ˆé€‰å‹æŒ‡å—" class="headerlink" title="ğŸ› ï¸ æŠ€æœ¯æ ˆé€‰å‹æŒ‡å—"></a>ğŸ› ï¸ æŠ€æœ¯æ ˆé€‰å‹æŒ‡å—</h2><h3 id="Spring-Cloudç”Ÿæ€ç³»ç»Ÿ"><a href="#Spring-Cloudç”Ÿæ€ç³»ç»Ÿ" class="headerlink" title="Spring Cloudç”Ÿæ€ç³»ç»Ÿ"></a>Spring Cloudç”Ÿæ€ç³»ç»Ÿ</h3><pre class="mermaid">graph TB    A[Spring Cloud Gateway] --> B[æœåŠ¡ç½‘å…³]    C[Eureka/Consul] --> D[æœåŠ¡æ³¨å†Œå‘ç°]    E[Hystrix/Resilience4j] --> F[ç†”æ–­é™çº§]    G[Spring Cloud Config] --> H[é…ç½®ç®¡ç†]    I[Sleuth + Zipkin] --> J[é“¾è·¯è¿½è¸ª]    K[Spring Security] --> L[å®‰å…¨è®¤è¯]        subgraph "å®Œæ•´æŠ€æœ¯æ ˆ"        B        D        F        H        J        L    end</pre><h3 id="å®¹å™¨åŒ–éƒ¨ç½²"><a href="#å®¹å™¨åŒ–éƒ¨ç½²" class="headerlink" title="å®¹å™¨åŒ–éƒ¨ç½²"></a>å®¹å™¨åŒ–éƒ¨ç½²</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile æœ€ä½³å®è·µ</span></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">11</span>-jre-slim</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºérootç”¨æˆ·</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> groupadd -r spring &amp;&amp; useradd -r -g spring spring</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å·¥ä½œç›®å½•</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶jaråŒ…</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/user-service-*.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¥åº·æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=30s --<span class="built_in">timeout</span>=3s --start-period=5s --retries=3 \</span></span><br><span class="line"><span class="language-bash">  CMD curl -f http://localhost:8080/actuator/health || <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ‡æ¢åˆ°érootç”¨æˆ·</span></span><br><span class="line"><span class="keyword">USER</span> spring:spring</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨åº”ç”¨</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;/app/app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure><h2 id="ğŸª-å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†ç³»ç»Ÿå¾®æœåŠ¡åŒ–"><a href="#ğŸª-å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†ç³»ç»Ÿå¾®æœåŠ¡åŒ–" class="headerlink" title="ğŸª å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†ç³»ç»Ÿå¾®æœåŠ¡åŒ–"></a>ğŸª å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†ç³»ç»Ÿå¾®æœåŠ¡åŒ–</h2><h3 id="ç³»ç»Ÿæ¶æ„å›¾"><a href="#ç³»ç»Ÿæ¶æ„å›¾" class="headerlink" title="ç³»ç»Ÿæ¶æ„å›¾"></a>ç³»ç»Ÿæ¶æ„å›¾</h3><pre class="mermaid">graph TB    subgraph "å‰ç«¯å±‚"        A[Webå‰ç«¯]        B[ç§»åŠ¨ç«¯APP]        C[ç®¡ç†åå°]    end        subgraph "APIç½‘å…³å±‚"        D[Spring Cloud Gateway]    end        subgraph "å¾®æœåŠ¡å±‚"        E[ç”¨æˆ·æœåŠ¡]        F[å•†å“æœåŠ¡]        G[è®¢å•æœåŠ¡]        H[æ”¯ä»˜æœåŠ¡]        I[åº“å­˜æœåŠ¡]        J[é€šçŸ¥æœåŠ¡]        K[æ¨èæœåŠ¡]    end        subgraph "åŸºç¡€è®¾æ–½å±‚"        L[(ç”¨æˆ·æ•°æ®åº“)]        M[(å•†å“æ•°æ®åº“)]        N[(è®¢å•æ•°æ®åº“)]        O[Redisç¼“å­˜]        P[æ¶ˆæ¯é˜Ÿåˆ—]        Q[æ–‡ä»¶å­˜å‚¨]    end        A --> D    B --> D    C --> D        D --> E    D --> F    D --> G    D --> H    D --> I    D --> J    D --> K        E --> L    F --> M    G --> N    E --> O    F --> O    G --> P    H --> P    I --> P    J --> P    K --> Q</pre><h3 id="æœåŠ¡æ‹†åˆ†ç­–ç•¥"><a href="#æœåŠ¡æ‹†åˆ†ç­–ç•¥" class="headerlink" title="æœåŠ¡æ‹†åˆ†ç­–ç•¥"></a>æœåŠ¡æ‹†åˆ†ç­–ç•¥</h3><h4 id="ç”¨æˆ·æœåŠ¡-User-Service"><a href="#ç”¨æˆ·æœåŠ¡-User-Service" class="headerlink" title="ç”¨æˆ·æœåŠ¡ (User Service)"></a>ç”¨æˆ·æœåŠ¡ (User Service)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;UserRegistrationResponse&gt; <span class="title function_">register</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UserRegistrationRequest request)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">UserRegistrationResponse</span> <span class="variable">response</span> <span class="operator">=</span> userService.registerUser(request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;UserDetailResponse&gt; <span class="title function_">getUserDetail</span><span class="params">(<span class="meta">@PathVariable</span> Long userId)</span> &#123;</span><br><span class="line">        <span class="type">UserDetailResponse</span> <span class="variable">response</span> <span class="operator">=</span> userService.getUserDetail(userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;userId&#125;/profile&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">updateProfile</span><span class="params">(<span class="meta">@PathVariable</span> Long userId,</span></span><br><span class="line"><span class="params">                                            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> UpdateProfileRequest request)</span> &#123;</span><br><span class="line">        userService.updateProfile(userId, request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PasswordEncoder passwordEncoder;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ApplicationEventPublisher eventPublisher;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> UserRegistrationResponse <span class="title function_">registerUser</span><span class="params">(UserRegistrationRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// éªŒè¯ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (userRepository.existsByUsername(request.getUsername())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UserAlreadyExistsException</span>(<span class="string">&quot;ç”¨æˆ·åå·²å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆ›å»ºæ–°ç”¨æˆ·</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> User.builder()</span><br><span class="line">                .username(request.getUsername())</span><br><span class="line">                .email(request.getEmail())</span><br><span class="line">                .passwordHash(passwordEncoder.encode(request.getPassword()))</span><br><span class="line">                .status(UserStatus.ACTIVE)</span><br><span class="line">                .createdAt(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        <span class="type">User</span> <span class="variable">savedUser</span> <span class="operator">=</span> userRepository.save(user);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‘å¸ƒç”¨æˆ·æ³¨å†Œäº‹ä»¶</span></span><br><span class="line">        eventPublisher.publishEvent(<span class="keyword">new</span> <span class="title class_">UserRegisteredEvent</span>(savedUser.getId(), savedUser.getEmail()));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> UserRegistrationResponse.from(savedUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è®¢å•æœåŠ¡-Order-Service"><a href="#è®¢å•æœåŠ¡-Order-Service" class="headerlink" title="è®¢å•æœåŠ¡ (Order Service)"></a>è®¢å•æœåŠ¡ (Order Service)</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/orders&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;CreateOrderResponse&gt; <span class="title function_">createOrder</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@Valid</span> <span class="meta">@RequestBody</span> CreateOrderRequest request,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestHeader(&quot;X-User-Id&quot;)</span> Long userId)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">CreateOrderResponse</span> <span class="variable">response</span> <span class="operator">=</span> orderService.createOrder(request, userId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.CREATED).body(response);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;orderId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;OrderDetailResponse&gt; <span class="title function_">getOrderDetail</span><span class="params">(<span class="meta">@PathVariable</span> String orderId)</span> &#123;</span><br><span class="line">        <span class="type">OrderDetailResponse</span> <span class="variable">response</span> <span class="operator">=</span> orderService.getOrderDetail(orderId);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderRepository orderRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryServiceClient inventoryServiceClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PaymentServiceClient paymentServiceClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CreateOrderResponse <span class="title function_">createOrder</span><span class="params">(CreateOrderRequest request, Long userId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. éªŒè¯åº“å­˜</span></span><br><span class="line">        List&lt;InventoryCheckResult&gt; inventoryResults = </span><br><span class="line">            inventoryServiceClient.checkInventory(request.getItems());</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">if</span> (!inventoryResults.stream().allMatch(InventoryCheckResult::isAvailable)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InsufficientInventoryException</span>(<span class="string">&quot;åº“å­˜ä¸è¶³&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. åˆ›å»ºè®¢å•</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> Order.builder()</span><br><span class="line">                .orderId(generateOrderId())</span><br><span class="line">                .userId(userId)</span><br><span class="line">                .items(request.getItems())</span><br><span class="line">                .totalAmount(calculateTotalAmount(request.getItems()))</span><br><span class="line">                .status(OrderStatus.PENDING_PAYMENT)</span><br><span class="line">                .createdAt(LocalDateTime.now())</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        <span class="type">Order</span> <span class="variable">savedOrder</span> <span class="operator">=</span> orderRepository.save(order);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. é¢„ç•™åº“å­˜</span></span><br><span class="line">        inventoryServiceClient.reserveInventory(savedOrder.getOrderId(), request.getItems());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. å‘é€è®¢å•åˆ›å»ºäº‹ä»¶</span></span><br><span class="line">        <span class="type">OrderCreatedEvent</span> <span class="variable">event</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderCreatedEvent</span>(savedOrder.getOrderId(), userId, savedOrder.getTotalAmount());</span><br><span class="line">        rabbitTemplate.convertAndSend(<span class="string">&quot;order.exchange&quot;</span>, <span class="string">&quot;order.created&quot;</span>, event);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> CreateOrderResponse.from(savedOrder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æœåŠ¡é—´é€šä¿¡"><a href="#æœåŠ¡é—´é€šä¿¡" class="headerlink" title="æœåŠ¡é—´é€šä¿¡"></a>æœåŠ¡é—´é€šä¿¡</h3><h4 id="1-åŒæ­¥é€šä¿¡-Feign-Client"><a href="#1-åŒæ­¥é€šä¿¡-Feign-Client" class="headerlink" title="1. åŒæ­¥é€šä¿¡ - Feign Client"></a>1. åŒæ­¥é€šä¿¡ - Feign Client</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(name = &quot;inventory-service&quot;, fallback = InventoryServiceFallback.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InventoryServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/api/inventory/check&quot;)</span></span><br><span class="line">    List&lt;InventoryCheckResult&gt; <span class="title function_">checkInventory</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;OrderItem&gt; items)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/api/inventory/reserve&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">reserveInventory</span><span class="params">(<span class="meta">@RequestParam</span> String orderId, <span class="meta">@RequestBody</span> List&lt;OrderItem&gt; items)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/api/inventory/release&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">releaseInventory</span><span class="params">(<span class="meta">@RequestParam</span> String orderId)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InventoryServiceFallback</span> <span class="keyword">implements</span> <span class="title class_">InventoryServiceClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;InventoryCheckResult&gt; <span class="title function_">checkInventory</span><span class="params">(List&lt;OrderItem&gt; items)</span> &#123;</span><br><span class="line">        <span class="comment">// é™çº§ç­–ç•¥ï¼šå‡è®¾åº“å­˜å……è¶³</span></span><br><span class="line">        <span class="keyword">return</span> items.stream()</span><br><span class="line">                .map(item -&gt; InventoryCheckResult.builder()</span><br><span class="line">                        .productId(item.getProductId())</span><br><span class="line">                        .available(<span class="literal">true</span>)</span><br><span class="line">                        .availableQuantity(item.getQuantity())</span><br><span class="line">                        .build())</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reserveInventory</span><span class="params">(String orderId, List&lt;OrderItem&gt; items)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;åº“å­˜æœåŠ¡ä¸å¯ç”¨ï¼Œè®¢å• &#123;&#125; çš„åº“å­˜é¢„ç•™æ“ä½œå·²é™çº§&quot;</span>, orderId);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">releaseInventory</span><span class="params">(String orderId)</span> &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;åº“å­˜æœåŠ¡ä¸å¯ç”¨ï¼Œè®¢å• &#123;&#125; çš„åº“å­˜é‡Šæ”¾æ“ä½œå·²é™çº§&quot;</span>, orderId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-å¼‚æ­¥é€šä¿¡-æ¶ˆæ¯é˜Ÿåˆ—"><a href="#2-å¼‚æ­¥é€šä¿¡-æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="2. å¼‚æ­¥é€šä¿¡ - æ¶ˆæ¯é˜Ÿåˆ—"></a>2. å¼‚æ­¥é€šä¿¡ - æ¶ˆæ¯é˜Ÿåˆ—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderEventListener</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> InventoryService inventoryService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> NotificationService notificationService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;order.payment.success.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentSuccess</span><span class="params">(PaymentSuccessEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç¡®è®¤åº“å­˜æ‰£å‡</span></span><br><span class="line">            inventoryService.confirmInventoryDeduction(event.getOrderId());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å‘é€è®¢å•æˆåŠŸé€šçŸ¥</span></span><br><span class="line">            notificationService.sendOrderSuccessNotification(event.getUserId(), event.getOrderId());</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å¤„ç†æ”¯ä»˜æˆåŠŸäº‹ä»¶å¤±è´¥: orderId=&#123;&#125;, error=&#123;&#125;&quot;</span>, event.getOrderId(), e.getMessage());</span><br><span class="line">            <span class="comment">// é‡è¯•æœºåˆ¶æˆ–æ­»ä¿¡é˜Ÿåˆ—å¤„ç†</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;order.payment.failed.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handlePaymentFailed</span><span class="params">(PaymentFailedEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// é‡Šæ”¾é¢„ç•™åº“å­˜</span></span><br><span class="line">            inventoryService.releaseReservedInventory(event.getOrderId());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ›´æ–°è®¢å•çŠ¶æ€</span></span><br><span class="line">            orderService.updateOrderStatus(event.getOrderId(), OrderStatus.PAYMENT_FAILED);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å¤„ç†æ”¯ä»˜å¤±è´¥äº‹ä»¶å¤±è´¥: orderId=&#123;&#125;, error=&#123;&#125;&quot;</span>, event.getOrderId(), e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="âš ï¸-å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ"><a href="#âš ï¸-å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="âš ï¸ å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ"></a>âš ï¸ å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"><a href="#1-åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="headerlink" title="1. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"></a>1. åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h3><p><strong>é—®é¢˜æè¿°</strong>ï¼šè·¨æœåŠ¡çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šSagaæ¨¡å¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderSagaOrchestrator</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processOrder</span><span class="params">(CreateOrderRequest request)</span> &#123;</span><br><span class="line">        <span class="type">SagaTransaction</span> <span class="variable">saga</span> <span class="operator">=</span> SagaTransaction.builder()</span><br><span class="line">                .addStep(<span class="keyword">new</span> <span class="title class_">CreateOrderStep</span>())</span><br><span class="line">                .addStep(<span class="keyword">new</span> <span class="title class_">ReserveInventoryStep</span>())</span><br><span class="line">                .addStep(<span class="keyword">new</span> <span class="title class_">ProcessPaymentStep</span>())</span><br><span class="line">                .addStep(<span class="keyword">new</span> <span class="title class_">SendNotificationStep</span>())</span><br><span class="line">                .build();</span><br><span class="line">                </span><br><span class="line">        saga.execute(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreateOrderStep</span> <span class="keyword">implements</span> <span class="title class_">SagaStep</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(Object data)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºè®¢å•é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">compensate</span><span class="params">(Object data)</span> &#123;</span><br><span class="line">        <span class="comment">// å–æ¶ˆè®¢å•é€»è¾‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-æœåŠ¡é›ªå´©é—®é¢˜"><a href="#2-æœåŠ¡é›ªå´©é—®é¢˜" class="headerlink" title="2. æœåŠ¡é›ªå´©é—®é¢˜"></a>2. æœåŠ¡é›ªå´©é—®é¢˜</h3><p><strong>é—®é¢˜æè¿°</strong>ï¼šå•ä¸ªæœåŠ¡æ•…éšœå¯¼è‡´è¿é”ååº”</p><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç†”æ–­å™¨ + é™çº§ç­–ç•¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductServiceClient productServiceClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@CircuitBreaker(name = &quot;product-service&quot;, fallbackMethod = &quot;getProductDetailFallback&quot;)</span></span><br><span class="line">    <span class="meta">@TimeLimiter(name = &quot;product-service&quot;)</span></span><br><span class="line">    <span class="meta">@Retry(name = &quot;product-service&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;ProductDetail&gt; <span class="title function_">getProductDetail</span><span class="params">(Long productId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">            productServiceClient.getProductDetail(productId));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> CompletableFuture&lt;ProductDetail&gt; <span class="title function_">getProductDetailFallback</span><span class="params">(Long productId, Exception ex)</span> &#123;</span><br><span class="line">        <span class="comment">// é™çº§ç­–ç•¥ï¼šè¿”å›åŸºç¡€å•†å“ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> CompletableFuture.completedFuture(</span><br><span class="line">            ProductDetail.builder()</span><br><span class="line">                .id(productId)</span><br><span class="line">                .name(<span class="string">&quot;å•†å“ä¿¡æ¯æš‚æ—¶æ— æ³•è·å–&quot;</span>)</span><br><span class="line">                .available(<span class="literal">false</span>)</span><br><span class="line">                .build()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-é…ç½®ç®¡ç†å¤æ‚æ€§"><a href="#3-é…ç½®ç®¡ç†å¤æ‚æ€§" class="headerlink" title="3. é…ç½®ç®¡ç†å¤æ‚æ€§"></a>3. é…ç½®ç®¡ç†å¤æ‚æ€§</h3><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç»Ÿä¸€é…ç½®ä¸­å¿ƒ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application-dev.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://config-server:8888</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">dev</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">order-service</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bootstrap.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">$&#123;CONFIG_SERVER_URL:http://localhost:8888&#125;</span></span><br><span class="line">      <span class="attr">fail-fast:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">retry:</span></span><br><span class="line">        <span class="attr">max-attempts:</span> <span class="number">3</span></span><br><span class="line">        <span class="attr">max-interval:</span> <span class="number">2000</span></span><br></pre></td></tr></table></figure><h2 id="ğŸš€-æ€»ç»“ä¸å±•æœ›"><a href="#ğŸš€-æ€»ç»“ä¸å±•æœ›" class="headerlink" title="ğŸš€ æ€»ç»“ä¸å±•æœ›"></a>ğŸš€ æ€»ç»“ä¸å±•æœ›</h2><p>å¾®æœåŠ¡æ¶æ„æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œå®ƒå¸¦æ¥äº†ï¼š</p><p><strong>æ”¶ç›Š</strong>ï¼š</p><ul><li>ğŸ¯ æŠ€æœ¯æ ˆå¤šæ ·åŒ–å’Œå›¢é˜Ÿç‹¬ç«‹æ€§</li><li>ğŸ“ˆ æŒ‰éœ€æ‰©å±•å’Œæ•…éšœéš”ç¦»</li><li>ğŸ”„ å¿«é€Ÿè¿­ä»£å’ŒæŒç»­éƒ¨ç½²</li></ul><p><strong>æŒ‘æˆ˜</strong>ï¼š</p><ul><li>ğŸŒ åˆ†å¸ƒå¼ç³»ç»Ÿå¤æ‚æ€§</li><li>ğŸ“Š è¿ç»´å’Œç›‘æ§éš¾åº¦å¢åŠ </li><li>ğŸ”„ æ•°æ®ä¸€è‡´æ€§ä¿è¯</li></ul><h3 id="æœ€ä½³å®è·µæ€»ç»“"><a href="#æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="æœ€ä½³å®è·µæ€»ç»“"></a>æœ€ä½³å®è·µæ€»ç»“</h3><ol><li><strong>æ¸è¿›å¼è¿ç§»</strong>ï¼šä»è¾¹ç¼˜æœåŠ¡å¼€å§‹ï¼Œé€æ­¥åˆ†è§£å•ä½“åº”ç”¨</li><li><strong>ç›‘æ§ä¸ºå…ˆ</strong>ï¼šå»ºç«‹å®Œå–„çš„ç›‘æ§ã€æ—¥å¿—å’Œè¿½è¸ªä½“ç³»</li><li><strong>è‡ªåŠ¨åŒ–æµ‹è¯•</strong>ï¼šæ„å»ºå®Œæ•´çš„æµ‹è¯•é‡‘å­—å¡”</li><li><strong>æ–‡æ¡£é©±åŠ¨</strong>ï¼šç»´æŠ¤APIæ–‡æ¡£å’Œæ¶æ„å†³ç­–è®°å½•</li><li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šå»ºç«‹è·¨å›¢é˜Ÿæ²Ÿé€šæœºåˆ¶</li></ol><blockquote><p>ğŸ’¡ <strong>è®°ä½</strong>ï¼šå¾®æœåŠ¡ä¸æ˜¯é“¶å¼¹ï¼Œè¦æ ¹æ®å›¢é˜Ÿè§„æ¨¡ã€ä¸šåŠ¡å¤æ‚åº¦å’ŒæŠ€æœ¯èƒ½åŠ›æ¥é€‰æ‹©åˆé€‚çš„æ¶æ„ç­–ç•¥ã€‚</p></blockquote><hr><h2 id="ğŸ“–-ç›¸å…³é˜…è¯»"><a href="#ğŸ“–-ç›¸å…³é˜…è¯»" class="headerlink" title="ğŸ“– ç›¸å…³é˜…è¯»"></a>ğŸ“– ç›¸å…³é˜…è¯»</h2><ul><li><a href="../distributed-systems-design/">åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡åŸç†</a></li><li><a href="../spring-cloud-gateway-guide/">Spring Cloud Gatewayå®æˆ˜æŒ‡å—</a></li><li><a href="../docker-best-practices/">Dockerå®¹å™¨åŒ–æœ€ä½³å®è·µ</a></li><li><a href="../kubernetes-microservices/">Kuberneteså¾®æœåŠ¡éƒ¨ç½²</a></li></ul><hr><p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€åˆ†äº«å’Œè¯„è®ºï¼</strong> ğŸŒŸ</p>]]></content>
      
      
      <categories>
          
          <category> æ¶æ„è®¾è®¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> æ¶æ„è®¾è®¡ </tag>
            
            <tag> åˆ†å¸ƒå¼ç³»ç»Ÿ </tag>
            
            <tag> Spring Cloud </tag>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¹¶å‘ç¼–ç¨‹æ·±åº¦è§£æï¼šä»ç†è®ºåˆ°å®è·µ</title>
      <link href="/2025/10/20/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/"/>
      <url>/2025/10/20/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="Javaå¹¶å‘ç¼–ç¨‹æ·±åº¦è§£æï¼šä»ç†è®ºåˆ°å®è·µ"><a href="#Javaå¹¶å‘ç¼–ç¨‹æ·±åº¦è§£æï¼šä»ç†è®ºåˆ°å®è·µ" class="headerlink" title="Javaå¹¶å‘ç¼–ç¨‹æ·±åº¦è§£æï¼šä»ç†è®ºåˆ°å®è·µ"></a>Javaå¹¶å‘ç¼–ç¨‹æ·±åº¦è§£æï¼šä»ç†è®ºåˆ°å®è·µ</h1><blockquote><p>ğŸ§µ <strong>å¹¶å‘ç¼–ç¨‹æ ¸å¿ƒè¦ç‚¹</strong></p><ul><li>æ·±å…¥ç†è§£Javaå†…å­˜æ¨¡å‹å’Œhappens-beforeåŸåˆ™</li><li>æŒæ¡synchronizedã€volatileã€Lockç­‰åŒæ­¥æœºåˆ¶</li><li>ç†Ÿç»ƒè¿ç”¨çº¿ç¨‹æ± å’Œå¹¶å‘å·¥å…·ç±»</li><li>äº†è§£å¸¸è§å¹¶å‘é—®é¢˜çš„åŸå› å’Œè§£å†³æ–¹æ¡ˆ</li><li>å­¦ä¹ é«˜æ€§èƒ½å¹¶å‘ç¼–ç¨‹çš„æœ€ä½³å®è·µ</li></ul></blockquote><h2 id="ğŸ¯-ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘ç¼–ç¨‹ï¼Ÿ"><a href="#ğŸ¯-ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘ç¼–ç¨‹ï¼Ÿ" class="headerlink" title="ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘ç¼–ç¨‹ï¼Ÿ"></a>ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦å¹¶å‘ç¼–ç¨‹ï¼Ÿ</h2><p>åœ¨ç°ä»£è®¡ç®—æœºç³»ç»Ÿä¸­ï¼ŒCPUé€šå¸¸æ‹¥æœ‰å¤šä¸ªæ ¸å¿ƒï¼Œä¸ºäº†å……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æºï¼Œæå‡ç¨‹åºæ€§èƒ½ï¼Œæˆ‘ä»¬éœ€è¦è®©ç¨‹åºèƒ½å¤ŸåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚è¿™å°±æ˜¯å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒä»·å€¼ã€‚</p><h3 id="å¹¶å‘-vs-å¹¶è¡Œ"><a href="#å¹¶å‘-vs-å¹¶è¡Œ" class="headerlink" title="å¹¶å‘ vs å¹¶è¡Œ"></a>å¹¶å‘ vs å¹¶è¡Œ</h3><pre class="mermaid">graph LR    subgraph "å¹¶å‘(Concurrency)"        A[Task1] -.-> B[Task2]        B -.-> C[Task3]        C -.-> A    end        subgraph "å¹¶è¡Œ(Parallelism)"        D[Task1]         E[Task2]        F[Task3]    end        A --> G[å•æ ¸CPUæ—¶é—´ç‰‡è½®è½¬]    D --> H[å¤šæ ¸CPUåŒæ—¶æ‰§è¡Œ]</pre><h2 id="ğŸ§ -Javaå†…å­˜æ¨¡å‹-JMM"><a href="#ğŸ§ -Javaå†…å­˜æ¨¡å‹-JMM" class="headerlink" title="ğŸ§  Javaå†…å­˜æ¨¡å‹ (JMM)"></a>ğŸ§  Javaå†…å­˜æ¨¡å‹ (JMM)</h2><h3 id="å†…å­˜æ¨¡å‹åŸºç¡€"><a href="#å†…å­˜æ¨¡å‹åŸºç¡€" class="headerlink" title="å†…å­˜æ¨¡å‹åŸºç¡€"></a>å†…å­˜æ¨¡å‹åŸºç¡€</h3><pre class="mermaid">graph TB    subgraph "JVMå†…å­˜ç»“æ„"        A[ä¸»å†…å­˜ Main Memory]                subgraph "çº¿ç¨‹1"            B[å·¥ä½œå†…å­˜1]            C[æœ¬åœ°å˜é‡å‰¯æœ¬]        end                subgraph "çº¿ç¨‹2"            D[å·¥ä½œå†…å­˜2]            E[æœ¬åœ°å˜é‡å‰¯æœ¬]        end                B <--> A        D <--> A        C -.-> B        E -.-> D    end</pre><h3 id="Happens-Beforeè§„åˆ™"><a href="#Happens-Beforeè§„åˆ™" class="headerlink" title="Happens-Beforeè§„åˆ™"></a>Happens-Beforeè§„åˆ™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HappensBeforeExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çº¿ç¨‹1æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writer</span><span class="params">()</span> &#123;</span><br><span class="line">        x = <span class="number">42</span>;           <span class="comment">// 1</span></span><br><span class="line">        flag = <span class="literal">true</span>;      <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çº¿ç¨‹2æ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reader</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag) &#123;       <span class="comment">// 3</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> x;    <span class="comment">// 4, yçš„å€¼ä¸€å®šæ˜¯42</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åˆ†æ</strong>ï¼šç”±äº<code>flag</code>æ˜¯volatileå˜é‡ï¼Œæ“ä½œ2 happens-before æ“ä½œ3ï¼Œè€Œæ“ä½œ1åœ¨æ“ä½œ2ä¹‹å‰ï¼Œæ“ä½œ4åœ¨æ“ä½œ3ä¹‹åï¼Œæ‰€ä»¥æ“ä½œ1 happens-before æ“ä½œ4ã€‚</p><h2 id="ğŸ”-åŒæ­¥æœºåˆ¶è¯¦è§£"><a href="#ğŸ”-åŒæ­¥æœºåˆ¶è¯¦è§£" class="headerlink" title="ğŸ” åŒæ­¥æœºåˆ¶è¯¦è§£"></a>ğŸ” åŒæ­¥æœºåˆ¶è¯¦è§£</h2><h3 id="1-synchronizedå…³é”®å­—"><a href="#1-synchronizedå…³é”®å­—" class="headerlink" title="1. synchronizedå…³é”®å­—"></a>1. synchronizedå…³é”®å­—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŒæ­¥æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment1</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŒæ­¥ä»£ç å— - å®ä¾‹é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŒæ­¥ä»£ç å— - ç§æœ‰é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment3</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é™æ€åŒæ­¥æ–¹æ³• - ç±»é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">staticMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é™æ€æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="synchronizedåº•å±‚å®ç°"><a href="#synchronizedåº•å±‚å®ç°" class="headerlink" title="synchronizedåº•å±‚å®ç°"></a>synchronizedåº•å±‚å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¼–è¯‘åçš„å­—èŠ‚ç ï¼ˆç®€åŒ–ç‰ˆï¼‰</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// monitorenter  // è·å–é”</span></span><br><span class="line">    count++;</span><br><span class="line">    <span class="comment">// monitorexit   // é‡Šæ”¾é”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-volatileå…³é”®å­—"><a href="#2-volatileå…³é”®å­—" class="headerlink" title="2. volatileå…³é”®å­—"></a>2. volatileå…³é”®å­—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VolatileExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">running</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        running = <span class="literal">false</span>;  <span class="comment">// ç«‹å³å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (running) &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">            counter++;    <span class="comment">// æ³¨æ„ï¼švolatileä¸ä¿è¯åŸå­æ€§</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é”™è¯¯ç¤ºä¾‹ï¼švolatileä¸èƒ½ä¿è¯å¤åˆæ“ä½œçš„åŸå­æ€§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">volatileCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">wrongIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">        volatileCount++;  <span class="comment">// è¿™ä¸æ˜¯åŸå­æ“ä½œï¼åŒ…å«è¯»å–ã€è®¡ç®—ã€å†™å…¥ä¸‰æ­¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨AtomicInteger</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">atomicCount</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">correctIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">        atomicCount.incrementAndGet();  <span class="comment">// è¿™æ˜¯åŸå­æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Lockæ¥å£å’ŒReentrantLock"><a href="#3-Lockæ¥å£å’ŒReentrantLock" class="headerlink" title="3. Lockæ¥å£å’ŒReentrantLock"></a>3. Lockæ¥å£å’ŒReentrantLock</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count++;</span><br><span class="line">            condition.signalAll();  <span class="comment">// å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();  <span class="comment">// ç¡®ä¿åœ¨finallyå—ä¸­é‡Šæ”¾é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">waitForCondition</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (count &lt; <span class="number">10</span>) &#123;</span><br><span class="line">                condition.await();  <span class="comment">// ç­‰å¾…æ¡ä»¶æ»¡è¶³</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ¡ä»¶æ»¡è¶³åçš„å¤„ç†é€»è¾‘</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯ä¸­æ–­çš„é”è·å–</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">interruptibleLock</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">if</span> (lock.tryLock(<span class="number">5</span>, TimeUnit.SECONDS)) &#123;  <span class="comment">// å°è¯•è·å–é”ï¼Œæœ€å¤šç­‰å¾…5ç§’</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </span></span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;æ— æ³•è·å–é”&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ReentrantLock-vs-synchronized"><a href="#ReentrantLock-vs-synchronized" class="headerlink" title="ReentrantLock vs synchronized"></a>ReentrantLock vs synchronized</h4><table><thead><tr><th>ç‰¹æ€§</th><th>synchronized</th><th>ReentrantLock</th></tr></thead><tbody><tr><td><strong>ä½¿ç”¨ç®€ä¾¿æ€§</strong></td><td>ğŸŸ¢ ç®€å•</td><td>ğŸŸ¡ éœ€è¦æ‰‹åŠ¨ç®¡ç†</td></tr><tr><td><strong>åŠŸèƒ½ä¸°å¯Œæ€§</strong></td><td>ğŸŸ¡ åŸºç¡€åŠŸèƒ½</td><td>ğŸŸ¢ åŠŸèƒ½ä¸°å¯Œ</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>ğŸŸ¢ JVMä¼˜åŒ–</td><td>ğŸŸ¡ ç›¸å½“</td></tr><tr><td><strong>å¯ä¸­æ–­æ€§</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td><strong>å…¬å¹³é”</strong></td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td><strong>æ¡ä»¶å˜é‡</strong></td><td>âŒ å•ä¸€wait&#x2F;notify</td><td>âœ… å¤šä¸ªCondition</td></tr></tbody></table><h2 id="ğŸ§µ-çº¿ç¨‹æ± è¯¦è§£"><a href="#ğŸ§µ-çº¿ç¨‹æ± è¯¦è§£" class="headerlink" title="ğŸ§µ çº¿ç¨‹æ± è¯¦è§£"></a>ğŸ§µ çº¿ç¨‹æ± è¯¦è§£</h2><h3 id="ThreadPoolExecutorå‚æ•°è§£æ"><a href="#ThreadPoolExecutorå‚æ•°è§£æ" class="headerlink" title="ThreadPoolExecutorå‚æ•°è§£æ"></a>ThreadPoolExecutorå‚æ•°è§£æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadPoolExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰çº¿ç¨‹æ± </span></span><br><span class="line">        <span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">            <span class="number">5</span>,                              <span class="comment">// corePoolSize: æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">            <span class="number">10</span>,                             <span class="comment">// maximumPoolSize: æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">            <span class="number">60L</span>,                            <span class="comment">// keepAliveTime: ç©ºé—²çº¿ç¨‹å­˜æ´»æ—¶é—´</span></span><br><span class="line">            TimeUnit.SECONDS,               <span class="comment">// unit: æ—¶é—´å•ä½</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">100</span>),  <span class="comment">// workQueue: ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()  <span class="comment">// handler: æ‹’ç»ç­–ç•¥</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æäº¤ä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskNum</span> <span class="operator">=</span> i;</span><br><span class="line">            executor.submit(() -&gt; &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ‰§è¡Œä»»åŠ¡ &quot;</span> + taskNum + </span><br><span class="line">                    <span class="string">&quot; - çº¿ç¨‹: &quot;</span> + Thread.currentThread().getName());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¼˜é›…å…³é—­</span></span><br><span class="line">        executor.shutdown();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!executor.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                executor.shutdownNow();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            executor.shutdownNow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹"><a href="#çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹" class="headerlink" title="çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹"></a>çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹</h3><pre class="mermaid">flowchart TD    A[æäº¤ä»»åŠ¡] --> B{æ ¸å¿ƒçº¿ç¨‹æ± æ˜¯å¦å·²æ»¡?}    B -->|å¦| C[åˆ›å»ºæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œ]    B -->|æ˜¯| D{ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦å·²æ»¡?}    D -->|å¦| E[ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ç­‰å¾…]    D -->|æ˜¯| F{æœ€å¤§çº¿ç¨‹æ± æ˜¯å¦å·²æ»¡?}    F -->|å¦| G[åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œ]    F -->|æ˜¯| H[æ‰§è¡Œæ‹’ç»ç­–ç•¥]        C --> I[ä»»åŠ¡æ‰§è¡Œå®Œæˆ]    E --> I    G --> I</pre><h3 id="å¸¸ç”¨æ‹’ç»ç­–ç•¥"><a href="#å¸¸ç”¨æ‹’ç»ç­–ç•¥" class="headerlink" title="å¸¸ç”¨æ‹’ç»ç­–ç•¥"></a>å¸¸ç”¨æ‹’ç»ç­–ç•¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RejectionPolicyExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. CallerRunsPolicy - è°ƒç”¨è€…è¿è¡Œ</span></span><br><span class="line">    <span class="type">ThreadPoolExecutor</span> <span class="variable">executor1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">2</span>, <span class="number">4</span>, <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()  <span class="comment">// ä¸»çº¿ç¨‹æ‰§è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. AbortPolicy - æŠ›å‡ºå¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">    <span class="type">ThreadPoolExecutor</span> <span class="variable">executor2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">2</span>, <span class="number">4</span>, <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy()  <span class="comment">// æŠ›å‡ºRejectedExecutionException</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. DiscardPolicy - é™é»˜ä¸¢å¼ƒ</span></span><br><span class="line">    <span class="type">ThreadPoolExecutor</span> <span class="variable">executor3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">2</span>, <span class="number">4</span>, <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardPolicy()  <span class="comment">// ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸æŠ›å¼‚å¸¸</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. DiscardOldestPolicy - ä¸¢å¼ƒæœ€æ—§çš„</span></span><br><span class="line">    <span class="type">ThreadPoolExecutor</span> <span class="variable">executor4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">2</span>, <span class="number">4</span>, <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy()  <span class="comment">// ä¸¢å¼ƒé˜Ÿåˆ—å¤´éƒ¨æœ€æ—§çš„ä»»åŠ¡</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 5. è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥</span></span><br><span class="line">    <span class="type">ThreadPoolExecutor</span> <span class="variable">executor5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">        <span class="number">2</span>, <span class="number">4</span>, <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">        (task, executor) -&gt; &#123;</span><br><span class="line">            <span class="comment">// è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œå¦‚è®°å½•æ—¥å¿—ã€é™çº§å¤„ç†ç­‰</span></span><br><span class="line">            System.err.println(<span class="string">&quot;ä»»åŠ¡è¢«æ‹’ç»: &quot;</span> + task.toString());</span><br><span class="line">            <span class="comment">// å¯ä»¥é€‰æ‹©å°†ä»»åŠ¡å­˜å‚¨åˆ°æ•°æ®åº“æˆ–æ¶ˆæ¯é˜Ÿåˆ—ä¸­</span></span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ› ï¸-å¹¶å‘å·¥å…·ç±»"><a href="#ğŸ› ï¸-å¹¶å‘å·¥å…·ç±»" class="headerlink" title="ğŸ› ï¸ å¹¶å‘å·¥å…·ç±»"></a>ğŸ› ï¸ å¹¶å‘å·¥å…·ç±»</h2><h3 id="1-CountDownLatch-å€’è®¡æ—¶é—¨é—©"><a href="#1-CountDownLatch-å€’è®¡æ—¶é—¨é—©" class="headerlink" title="1. CountDownLatch - å€’è®¡æ—¶é—¨é—©"></a>1. CountDownLatch - å€’è®¡æ—¶é—¨é—©</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownLatchExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numTasks</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(numTasks);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¯åŠ¨å¤šä¸ªä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numTasks; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; å¼€å§‹æ‰§è¡Œ&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span> + taskId * <span class="number">500</span>);  <span class="comment">// æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œ</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; æ‰§è¡Œå®Œæˆ&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    latch.countDown();  <span class="comment">// å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œè®¡æ•°å‡1</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ...&quot;</span>);</span><br><span class="line">        latch.await();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-CyclicBarrier-å¾ªç¯æ …æ "><a href="#2-CyclicBarrier-å¾ªç¯æ …æ " class="headerlink" title="2. CyclicBarrier - å¾ªç¯æ …æ "></a>2. CyclicBarrier - å¾ªç¯æ …æ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CyclicBarrierExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numThreads</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">barrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(numThreads, () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æ …æ ï¼Œå¼€å§‹æ‰§è¡Œæ±‡æ€»æ“ä½œï¼&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numThreads; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">threadId</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// ç¬¬ä¸€é˜¶æ®µå·¥ä½œ</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + threadId + <span class="string">&quot; å®Œæˆç¬¬ä¸€é˜¶æ®µå·¥ä½œ&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span> + threadId * <span class="number">200</span>);</span><br><span class="line">                    </span><br><span class="line">                    barrier.await();  <span class="comment">// ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆç¬¬ä¸€é˜¶æ®µ</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// ç¬¬äºŒé˜¶æ®µå·¥ä½œ</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + threadId + <span class="string">&quot; å¼€å§‹ç¬¬äºŒé˜¶æ®µå·¥ä½œ&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">500</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;çº¿ç¨‹ &quot;</span> + threadId + <span class="string">&quot; å®Œæˆç¬¬äºŒé˜¶æ®µå·¥ä½œ&quot;</span>);</span><br><span class="line">                    </span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-Semaphore-ä¿¡å·é‡"><a href="#3-Semaphore-ä¿¡å·é‡" class="headerlink" title="3. Semaphore - ä¿¡å·é‡"></a>3. Semaphore - ä¿¡å·é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SemaphoreExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);  <span class="comment">// å…è®¸3ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">taskId</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; accessResource(taskId)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">accessResource</span><span class="params">(<span class="type">int</span> taskId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; ç­‰å¾…è·å–è®¸å¯è¯...&quot;</span>);</span><br><span class="line">            semaphore.acquire();  <span class="comment">// è·å–è®¸å¯è¯</span></span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; è·å¾—è®¸å¯è¯ï¼Œå¼€å§‹æ‰§è¡Œ&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);  <span class="comment">// æ¨¡æ‹Ÿèµ„æºä½¿ç”¨</span></span><br><span class="line">            System.out.println(<span class="string">&quot;ä»»åŠ¡ &quot;</span> + taskId + <span class="string">&quot; æ‰§è¡Œå®Œæˆï¼Œé‡Šæ”¾è®¸å¯è¯&quot;</span>);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            semaphore.release();  <span class="comment">// é‡Šæ”¾è®¸å¯è¯</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-åŸå­ç±»å®¶æ—"><a href="#4-åŸå­ç±»å®¶æ—" class="headerlink" title="4. åŸå­ç±»å®¶æ—"></a>4. åŸå­ç±»å®¶æ—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºæœ¬ç±»å‹åŸå­ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicLong</span> <span class="variable">longCounter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicBoolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicBoolean</span>(<span class="literal">false</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ•°ç»„ç±»å‹åŸå­ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicIntegerArray</span> <span class="variable">array</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicIntegerArray</span>(<span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¼•ç”¨ç±»å‹åŸå­ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicReference&lt;User&gt; userRef = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">basicAtomicOperations</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åŸºæœ¬æ“ä½œ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">oldValue</span> <span class="operator">=</span> counter.get();                    <span class="comment">// è·å–å½“å‰å€¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">newValue</span> <span class="operator">=</span> counter.incrementAndGet();        <span class="comment">// åŸå­é€’å¢å¹¶è¿”å›æ–°å€¼</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> counter.compareAndSet(<span class="number">1</span>, <span class="number">2</span>);   <span class="comment">// CASæ“ä½œ</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ•°ç»„æ“ä½œ</span></span><br><span class="line">        array.set(<span class="number">0</span>, <span class="number">100</span>);                              <span class="comment">// è®¾ç½®æŒ‡å®šä½ç½®çš„å€¼</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">arrayValue</span> <span class="operator">=</span> array.getAndIncrement(<span class="number">0</span>);       <span class="comment">// åŸå­é€’å¢æŒ‡å®šä½ç½®</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è‡ªå®šä¹‰æ›´æ–°é€»è¾‘</span></span><br><span class="line">        counter.updateAndGet(current -&gt; current * <span class="number">2</span>);    <span class="comment">// å½“å‰å€¼ä¹˜ä»¥2</span></span><br><span class="line">        counter.accumulateAndGet(<span class="number">10</span>, Integer::sum);      <span class="comment">// å½“å‰å€¼åŠ 10</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰åŸå­æ“ä½œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">customAtomicOperation</span><span class="params">()</span> &#123;</span><br><span class="line">        AtomicReference&lt;Node&gt; head = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ— é”æ ˆçš„pushæ“ä½œ</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="string">&quot;data&quot;</span>);</span><br><span class="line">        Node currentHead;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            currentHead = head.get();</span><br><span class="line">            newNode.next = currentHead;</span><br><span class="line">        &#125; <span class="keyword">while</span> (!head.compareAndSet(currentHead, newNode));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">        String name;</span><br><span class="line">        <span class="type">int</span> age;</span><br><span class="line">        </span><br><span class="line">        User(String name, <span class="type">int</span> age) &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        String data;</span><br><span class="line">        Node next;</span><br><span class="line">        </span><br><span class="line">        Node(String data) &#123;</span><br><span class="line">            <span class="built_in">this</span>.data = data;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸš¨-å¸¸è§å¹¶å‘é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"><a href="#ğŸš¨-å¸¸è§å¹¶å‘é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ" class="headerlink" title="ğŸš¨ å¸¸è§å¹¶å‘é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ"></a>ğŸš¨ å¸¸è§å¹¶å‘é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ</h2><h3 id="1-æ­»é”é—®é¢˜"><a href="#1-æ­»é”é—®é¢˜" class="headerlink" title="1. æ­»é”é—®é¢˜"></a>1. æ­»é”é—®é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadlockExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯èƒ½å‘ç”Ÿæ­»é”çš„ä»£ç </span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–¹æ³•1è·å¾—lock1&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ–¹æ³•1è·å¾—lock2&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ–¹æ³•2è·å¾—lock2&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">100</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æ–¹æ³•2è·å¾—lock1&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£å†³æ–¹æ¡ˆ1ï¼šç»Ÿä¸€è·å–é”çš„é¡ºåº</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">safeMethod1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">safeMethod2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;  <span class="comment">// ä¸method1ä¿æŒç›¸åŒçš„é”é¡ºåº</span></span><br><span class="line">            <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">                <span class="comment">// ä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨tryLockè®¾ç½®è¶…æ—¶</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">reentrantLock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">reentrantLock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">timeoutMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">lock1Acquired</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">lock2Acquired</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock1Acquired = reentrantLock1.tryLock(<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">            <span class="keyword">if</span> (lock1Acquired) &#123;</span><br><span class="line">                lock2Acquired = reentrantLock2.tryLock(<span class="number">1</span>, TimeUnit.SECONDS);</span><br><span class="line">                <span class="keyword">if</span> (lock2Acquired) &#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (lock2Acquired) reentrantLock2.unlock();</span><br><span class="line">            <span class="keyword">if</span> (lock1Acquired) reentrantLock1.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜"><a href="#2-ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜" class="headerlink" title="2. ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜"></a>2. ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProducerConsumerExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BlockingQueue&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicBoolean</span> <span class="variable">running</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicBoolean</span>(<span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”Ÿäº§è€…</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Producer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (running.get()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">item</span> <span class="operator">=</span> <span class="string">&quot;Item-&quot;</span> + count++;</span><br><span class="line">                    queue.put(item);  <span class="comment">// é˜Ÿåˆ—æ»¡æ—¶ä¼šé˜»å¡</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;ç”Ÿäº§: &quot;</span> + item);</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ¶ˆè´¹è€…</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Consumer</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">        </span><br><span class="line">        Consumer(String name) &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (running.get() || !queue.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">item</span> <span class="operator">=</span> queue.poll(<span class="number">1</span>, TimeUnit.SECONDS);  <span class="comment">// è¶…æ—¶ç­‰å¾…</span></span><br><span class="line">                    <span class="keyword">if</span> (item != <span class="literal">null</span>) &#123;</span><br><span class="line">                        System.out.println(name + <span class="string">&quot; æ¶ˆè´¹: &quot;</span> + item);</span><br><span class="line">                        Thread.sleep(<span class="number">150</span>);  <span class="comment">// æ¨¡æ‹Ÿå¤„ç†æ—¶é—´</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å¯åŠ¨1ä¸ªç”Ÿäº§è€…å’Œ2ä¸ªæ¶ˆè´¹è€…</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Producer</span>()).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Consumer</span>(<span class="string">&quot;æ¶ˆè´¹è€…1&quot;</span>)).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Consumer</span>(<span class="string">&quot;æ¶ˆè´¹è€…2&quot;</span>)).start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 10ç§’ååœæ­¢</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">10000</span>);</span><br><span class="line">                running.set(<span class="literal">false</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;åœæ­¢ç”Ÿäº§æ¶ˆè´¹&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"><a href="#3-ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="3. ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜"></a>3. ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheConsistencyExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, String&gt; cache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantReadWriteLock</span> <span class="variable">rwLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é—®é¢˜ç‰ˆæœ¬ï¼šå¯èƒ½å‡ºç°ç¼“å­˜ä¸ä¸€è‡´</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValue</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">        <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œå¯èƒ½æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œé€ æˆé‡å¤è®¡ç®—</span></span><br><span class="line">            value = expensiveOperation(key);</span><br><span class="line">            cache.put(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£å†³æ–¹æ¡ˆ1ï¼šä½¿ç”¨è¯»å†™é”</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValueWithRWLock</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆå°è¯•è¯»å–</span></span><br><span class="line">        rwLock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">            <span class="keyword">if</span> (value != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éœ€è¦è®¡ç®—å€¼ï¼Œè·å–å†™é”</span></span><br><span class="line">        rwLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åŒé‡æ£€æŸ¥</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> cache.get(key);</span><br><span class="line">            <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">                value = expensiveOperation(key);</span><br><span class="line">                cache.put(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨putIfAbsent</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValueWithPutIfAbsent</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cache.computeIfAbsent(key, <span class="built_in">this</span>::expensiveOperation);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨Futureé¿å…é‡å¤è®¡ç®—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Future&lt;String&gt;&gt; futureCache = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getValueWithFuture</span><span class="params">(String key)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        Future&lt;String&gt; future = futureCache.get(key);</span><br><span class="line">        <span class="keyword">if</span> (future == <span class="literal">null</span>) &#123;</span><br><span class="line">            Callable&lt;String&gt; callable = () -&gt; expensiveOperation(key);</span><br><span class="line">            FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(callable);</span><br><span class="line">            future = futureCache.putIfAbsent(key, futureTask);</span><br><span class="line">            <span class="keyword">if</span> (future == <span class="literal">null</span>) &#123;</span><br><span class="line">                future = futureTask;</span><br><span class="line">                futureTask.run();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> future.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">expensiveOperation</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);  <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Value for &quot;</span> + key;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ¯-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ"><a href="#ğŸ¯-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ" class="headerlink" title="ğŸ¯ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ"></a>ğŸ¯ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ</h2><h3 id="1-å‡å°‘é”çš„ç²’åº¦"><a href="#1-å‡å°‘é”çš„ç²’åº¦" class="headerlink" title="1. å‡å°‘é”çš„ç²’åº¦"></a>1. å‡å°‘é”çš„ç²’åº¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockGranularityExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç²—ç²’åº¦é” - ä¸æ¨è</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">counter1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">counter2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">coarseGrainedLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            counter1++;</span><br><span class="line">            counter2++;</span><br><span class="line">            <span class="comment">// å…¶ä»–ä¸ç›¸å…³çš„æ“ä½œä¹Ÿè¢«é”ä¿æŠ¤</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç»†ç²’åº¦é” - æ¨è</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fineGrainedLock1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock1) &#123;</span><br><span class="line">            counter1++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fineGrainedLock2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock2) &#123;</span><br><span class="line">            counter2++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨æ— é”æ•°æ®ç»“æ„"><a href="#2-ä½¿ç”¨æ— é”æ•°æ®ç»“æ„" class="headerlink" title="2. ä½¿ç”¨æ— é”æ•°æ®ç»“æ„"></a>2. ä½¿ç”¨æ— é”æ•°æ®ç»“æ„</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockFreeExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ— é”é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentLinkedQueue&lt;String&gt; lockFreeQueue = <span class="keyword">new</span> <span class="title class_">ConcurrentLinkedQueue</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ— é”Map</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, String&gt; lockFreeMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ— é”è®¡æ•°å™¨</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicLong</span> <span class="variable">lockFreeCounter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lockFreeOperations</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// é˜Ÿåˆ—æ“ä½œ</span></span><br><span class="line">        lockFreeQueue.offer(<span class="string">&quot;item&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">item</span> <span class="operator">=</span> lockFreeQueue.poll();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Mapæ“ä½œ</span></span><br><span class="line">        lockFreeMap.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> lockFreeMap.get(<span class="string">&quot;key&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡æ•°å™¨æ“ä½œ</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> lockFreeCounter.incrementAndGet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-åˆç†ä½¿ç”¨ThreadLocal"><a href="#3-åˆç†ä½¿ç”¨ThreadLocal" class="headerlink" title="3. åˆç†ä½¿ç”¨ThreadLocal"></a>3. åˆç†ä½¿ç”¨ThreadLocal</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”¨äºå­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;UserSession&gt; userSessionThreadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”¨äºæ ¼å¼åŒ–æ—¥æœŸï¼ˆSimpleDateFormatä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;SimpleDateFormat&gt; dateFormatThreadLocal = </span><br><span class="line">        ThreadLocal.withInitial(() -&gt; <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserSession</span><span class="params">(UserSession session)</span> &#123;</span><br><span class="line">        userSessionThreadLocal.set(session);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> UserSession <span class="title function_">getCurrentUser</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userSessionThreadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">formatDate</span><span class="params">(Date date)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> dateFormatThreadLocal.get().format(date);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é‡è¦ï¼šä½¿ç”¨å®Œæ¯•åè¦æ¸…ç†ThreadLocal</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cleanup</span><span class="params">()</span> &#123;</span><br><span class="line">        userSessionThreadLocal.remove();</span><br><span class="line">        dateFormatThreadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">UserSession</span> &#123;</span><br><span class="line">        String userId;</span><br><span class="line">        String userName;</span><br><span class="line">        <span class="comment">// å…¶ä»–ä¼šè¯ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ”-å¹¶å‘è°ƒè¯•æŠ€å·§"><a href="#ğŸ”-å¹¶å‘è°ƒè¯•æŠ€å·§" class="headerlink" title="ğŸ” å¹¶å‘è°ƒè¯•æŠ€å·§"></a>ğŸ” å¹¶å‘è°ƒè¯•æŠ€å·§</h2><h3 id="1-çº¿ç¨‹è½¬å‚¨åˆ†æ"><a href="#1-çº¿ç¨‹è½¬å‚¨åˆ†æ" class="headerlink" title="1. çº¿ç¨‹è½¬å‚¨åˆ†æ"></a>1. çº¿ç¨‹è½¬å‚¨åˆ†æ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadDumpExample</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printThreadDump</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadMXBean</span> <span class="variable">threadBean</span> <span class="operator">=</span> ManagementFactory.getThreadMXBean();</span><br><span class="line">        ThreadInfo[] threadInfos = threadBean.dumpAllThreads(<span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (ThreadInfo threadInfo : threadInfos) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹å: &quot;</span> + threadInfo.getThreadName());</span><br><span class="line">            System.out.println(<span class="string">&quot;çº¿ç¨‹çŠ¶æ€: &quot;</span> + threadInfo.getThreadState());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (threadInfo.getLockName() != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ç­‰å¾…é”: &quot;</span> + threadInfo.getLockName());</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            StackTraceElement[] stackTrace = threadInfo.getStackTrace();</span><br><span class="line">            <span class="keyword">for</span> (StackTraceElement element : stackTrace) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;\t&quot;</span> + element);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-å¹¶å‘æµ‹è¯•å·¥å…·"><a href="#2-å¹¶å‘æµ‹è¯•å·¥å…·" class="headerlink" title="2. å¹¶å‘æµ‹è¯•å·¥å…·"></a>2. å¹¶å‘æµ‹è¯•å·¥å…·</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrencyTestExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">AtomicInteger</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConcurrentIncrement</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">threadCount</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">operationsPerThread</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(threadCount);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; operationsPerThread; j++) &#123;</span><br><span class="line">                        counter.incrementAndGet();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    latch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        latch.await();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éªŒè¯ç»“æœ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">expected</span> <span class="operator">=</span> threadCount * operationsPerThread;</span><br><span class="line">        assertEquals(expected, counter.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸš€-æ€»ç»“ä¸æœ€ä½³å®è·µ"><a href="#ğŸš€-æ€»ç»“ä¸æœ€ä½³å®è·µ" class="headerlink" title="ğŸš€ æ€»ç»“ä¸æœ€ä½³å®è·µ"></a>ğŸš€ æ€»ç»“ä¸æœ€ä½³å®è·µ</h2><h3 id="å¹¶å‘ç¼–ç¨‹é‡‘å¾‹"><a href="#å¹¶å‘ç¼–ç¨‹é‡‘å¾‹" class="headerlink" title="å¹¶å‘ç¼–ç¨‹é‡‘å¾‹"></a>å¹¶å‘ç¼–ç¨‹é‡‘å¾‹</h3><ol><li><strong>ä¼˜å…ˆä½¿ç”¨å¹¶å‘å·¥å…·ç±»</strong>ï¼šConcurrentHashMap &gt; synchronized HashMap</li><li><strong>å‡å°‘é”çš„èŒƒå›´</strong>ï¼šåªé”å¿…è¦çš„ä»£ç å—</li><li><strong>é¿å…åµŒå¥—é”</strong>ï¼šé˜²æ­¢æ­»é”å‘ç”Ÿ</li><li><strong>ä½¿ç”¨ä¸å¯å˜å¯¹è±¡</strong>ï¼šå¤©ç„¶çº¿ç¨‹å®‰å…¨</li><li><strong>åˆç†ä½¿ç”¨çº¿ç¨‹æ± </strong>ï¼šé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯çº¿ç¨‹</li></ol><h3 id="æ€§èƒ½ä¼˜åŒ–checklist"><a href="#æ€§èƒ½ä¼˜åŒ–checklist" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–checklist"></a>æ€§èƒ½ä¼˜åŒ–checklist</h3><ul><li>âœ… ä½¿ç”¨åˆé€‚çš„å¹¶å‘å·¥å…·ç±»</li><li>âœ… å‡å°‘é”çš„ç«äº‰å’Œç²’åº¦</li><li>âœ… é¿å…ä¸å¿…è¦çš„åŒæ­¥</li><li>âœ… åˆç†è®¾ç½®çº¿ç¨‹æ± å‚æ•°</li><li>âœ… åŠæ—¶é‡Šæ”¾èµ„æºï¼ˆå¦‚ThreadLocalï¼‰</li></ul><h3 id="å¸¸è§è¯¯åŒº"><a href="#å¸¸è§è¯¯åŒº" class="headerlink" title="å¸¸è§è¯¯åŒº"></a>å¸¸è§è¯¯åŒº</h3><ul><li>âŒ è¿‡åº¦ä½¿ç”¨synchronized</li><li>âŒ å¿½ç•¥volatileçš„éåŸå­æ€§</li><li>âŒ ThreadLocalå†…å­˜æ³„æ¼</li><li>âŒ ä¸åˆç†çš„çº¿ç¨‹æ± é…ç½®</li></ul><blockquote><p>ğŸ’¡ <strong>è®°ä½</strong>ï¼šå¹¶å‘ç¼–ç¨‹æ˜¯ä¸€é—¨è‰ºæœ¯ï¼Œéœ€è¦åœ¨æ­£ç¡®æ€§ã€æ€§èƒ½å’Œå¤æ‚åº¦ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹ã€‚</p></blockquote><hr><h2 id="ğŸ“–-å»¶ä¼¸é˜…è¯»"><a href="#ğŸ“–-å»¶ä¼¸é˜…è¯»" class="headerlink" title="ğŸ“– å»¶ä¼¸é˜…è¯»"></a>ğŸ“– å»¶ä¼¸é˜…è¯»</h2><ul><li><a href="../jvm-memory-model/">JVMå†…å­˜æ¨¡å‹æ·±åº¦è§£æ</a></li><li><a href="../distributed-locks/">åˆ†å¸ƒå¼é”çš„è®¾è®¡ä¸å®ç°</a></li><li><a href="../high-concurrency-system-design/">é«˜å¹¶å‘ç³»ç»Ÿè®¾è®¡åŸç†</a></li></ul><hr><p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµåˆ†äº«ï¼</strong> â­</p>]]></content>
      
      
      <categories>
          
          <category> JavaæŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
            <tag> å¤šçº¿ç¨‹ </tag>
            
            <tag> JUC </tag>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç´¢å¼•ä¼˜åŒ–å®Œå…¨æŒ‡å—ï¼šä»åŸç†åˆ°å®æˆ˜</title>
      <link href="/2025/09/15/MySQL%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2025/09/15/MySQL%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="MySQLç´¢å¼•ä¼˜åŒ–å®Œå…¨æŒ‡å—ï¼šä»åŸç†åˆ°å®æˆ˜"><a href="#MySQLç´¢å¼•ä¼˜åŒ–å®Œå…¨æŒ‡å—ï¼šä»åŸç†åˆ°å®æˆ˜" class="headerlink" title="MySQLç´¢å¼•ä¼˜åŒ–å®Œå…¨æŒ‡å—ï¼šä»åŸç†åˆ°å®æˆ˜"></a>MySQLç´¢å¼•ä¼˜åŒ–å®Œå…¨æŒ‡å—ï¼šä»åŸç†åˆ°å®æˆ˜</h1><blockquote><p>ğŸ—ƒï¸ <strong>æ ¸å¿ƒçŸ¥è¯†ç‚¹</strong></p><ul><li>ç†è§£B+æ ‘ç´¢å¼•çš„åº•å±‚åŸç†</li><li>æŒæ¡ç´¢å¼•è®¾è®¡çš„é»„é‡‘æ³•åˆ™</li><li>å­¦ä¼šåˆ†æå’Œä¼˜åŒ–æ…¢æŸ¥è¯¢</li><li>é¿å…å¸¸è§çš„ç´¢å¼•å¤±æ•ˆåœºæ™¯</li></ul></blockquote><h2 id="ğŸ“š-ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"><a href="#ğŸ“š-ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ" class="headerlink" title="ğŸ“š ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ"></a>ğŸ“š ä»€ä¹ˆæ˜¯ç´¢å¼•ï¼Ÿ</h2><p>ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­ç”¨äº<strong>åŠ é€Ÿæ•°æ®æ£€ç´¢</strong>çš„æ•°æ®ç»“æ„ï¼Œç±»ä¼¼äºä¹¦ç±çš„ç›®å½•ã€‚æ²¡æœ‰ç´¢å¼•æ—¶ï¼Œæ•°æ®åº“éœ€è¦å…¨è¡¨æ‰«æï¼›æœ‰äº†ç´¢å¼•ï¼Œå¯ä»¥å¿«é€Ÿå®šä½æ•°æ®ã€‚</p><h2 id="ğŸŒ²-B-æ ‘ç´¢å¼•åŸç†"><a href="#ğŸŒ²-B-æ ‘ç´¢å¼•åŸç†" class="headerlink" title="ğŸŒ² B+æ ‘ç´¢å¼•åŸç†"></a>ğŸŒ² B+æ ‘ç´¢å¼•åŸç†</h2><h3 id="ä¸ºä»€ä¹ˆé€‰æ‹©B-æ ‘ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©B-æ ‘ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹©B+æ ‘ï¼Ÿ"></a>ä¸ºä»€ä¹ˆé€‰æ‹©B+æ ‘ï¼Ÿ</h3><table><thead><tr><th>æ•°æ®ç»“æ„</th><th>æŸ¥è¯¢å¤æ‚åº¦</th><th>èŒƒå›´æŸ¥è¯¢</th><th>ç£ç›˜IO</th></tr></thead><tbody><tr><td>å“ˆå¸Œè¡¨</td><td>O(1)</td><td>âŒ ä¸æ”¯æŒ</td><td>è¾ƒå°‘</td></tr><tr><td>äºŒå‰æ ‘</td><td>O(log n)</td><td>âœ… æ”¯æŒ</td><td>è¾ƒå¤š</td></tr><tr><td><strong>B+æ ‘</strong></td><td>O(log n)</td><td>âœ… æ”¯æŒ</td><td><strong>æœ€å°‘</strong></td></tr></tbody></table><h3 id="B-æ ‘ç»“æ„ç¤ºæ„"><a href="#B-æ ‘ç»“æ„ç¤ºæ„" class="headerlink" title="B+æ ‘ç»“æ„ç¤ºæ„"></a>B+æ ‘ç»“æ„ç¤ºæ„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">              [æ ¹èŠ‚ç‚¹: 50]</span><br><span class="line">             /            \</span><br><span class="line">    [20, 35]              [70, 85]</span><br><span class="line">   /    |    \           /    |    \</span><br><span class="line">[10,15] [25,30] [40,45] [60,65] [75,80] [90,95]</span><br><span class="line">   â†“       â†“       â†“       â†“       â†“       â†“</span><br><span class="line"> æ•°æ®    æ•°æ®    æ•°æ®    æ•°æ®    æ•°æ®    æ•°æ®</span><br><span class="line"> </span><br><span class="line"> å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨ç›¸è¿ï¼Œæ”¯æŒèŒƒå›´æŸ¥è¯¢</span><br></pre></td></tr></table></figure><h2 id="ğŸ¯-ç´¢å¼•ç±»å‹è¯¦è§£"><a href="#ğŸ¯-ç´¢å¼•ç±»å‹è¯¦è§£" class="headerlink" title="ğŸ¯ ç´¢å¼•ç±»å‹è¯¦è§£"></a>ğŸ¯ ç´¢å¼•ç±»å‹è¯¦è§£</h2><h3 id="1-ä¸»é”®ç´¢å¼•-Primary-Key"><a href="#1-ä¸»é”®ç´¢å¼•-Primary-Key" class="headerlink" title="1. ä¸»é”®ç´¢å¼• (Primary Key)"></a>1. ä¸»é”®ç´¢å¼• (Primary Key)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ›å»ºè¡¨æ—¶å®šä¹‰ä¸»é”®</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    username <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- InnoDBä¸­ï¼Œä¸»é”®ç´¢å¼•å³èšç°‡ç´¢å¼•ï¼Œæ•°æ®å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹</span></span><br></pre></td></tr></table></figure><h3 id="2-å”¯ä¸€ç´¢å¼•-Unique-Index"><a href="#2-å”¯ä¸€ç´¢å¼•-Unique-Index" class="headerlink" title="2. å”¯ä¸€ç´¢å¼• (Unique Index)"></a>2. å”¯ä¸€ç´¢å¼• (Unique Index)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¿è¯åˆ—å€¼å”¯ä¸€</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_email <span class="keyword">ON</span> users(email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- æˆ–åœ¨åˆ›å»ºè¡¨æ—¶å®šä¹‰</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> users (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="3-æ™®é€šç´¢å¼•-Normal-Index"><a href="#3-æ™®é€šç´¢å¼•-Normal-Index" class="headerlink" title="3. æ™®é€šç´¢å¼• (Normal Index)"></a>3. æ™®é€šç´¢å¼• (Normal Index)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æœ€åŸºæœ¬çš„ç´¢å¼•ç±»å‹</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_username <span class="keyword">ON</span> users(username);</span><br></pre></td></tr></table></figure><h3 id="4-è”åˆç´¢å¼•-Composite-Index"><a href="#4-è”åˆç´¢å¼•-Composite-Index" class="headerlink" title="4. è”åˆç´¢å¼• (Composite Index)"></a>4. è”åˆç´¢å¼• (Composite Index)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¤šåˆ—ç»„åˆç´¢å¼•ï¼Œéµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_age_city <span class="keyword">ON</span> users(name, age, city);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âœ… èƒ½ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">AND</span> age <span class="operator">=</span> <span class="number">25</span> <span class="keyword">AND</span> city <span class="operator">=</span> <span class="string">&#x27;åŒ—äº¬&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âŒ æ— æ³•ä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span>;  <span class="comment">-- è·³è¿‡äº†name</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> city <span class="operator">=</span> <span class="string">&#x27;åŒ—äº¬&#x27;</span>;  <span class="comment">-- è·³è¿‡äº†nameå’Œage</span></span><br></pre></td></tr></table></figure><h3 id="5-è¦†ç›–ç´¢å¼•-Covering-Index"><a href="#5-è¦†ç›–ç´¢å¼•-Covering-Index" class="headerlink" title="5. è¦†ç›–ç´¢å¼• (Covering Index)"></a>5. è¦†ç›–ç´¢å¼• (Covering Index)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å½“æŸ¥è¯¢çš„åˆ—éƒ½åœ¨ç´¢å¼•ä¸­æ—¶ï¼Œæ— éœ€å›è¡¨</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_name_email <span class="keyword">ON</span> users(name, email);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âœ… è¦†ç›–ç´¢å¼•ï¼Œä¸éœ€è¦å›è¡¨</span></span><br><span class="line"><span class="keyword">SELECT</span> name, email <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âŒ éœ€è¦å›è¡¨è·å–å…¶ä»–åˆ—</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="ğŸ”§-EXPLAINåˆ†ææŸ¥è¯¢"><a href="#ğŸ”§-EXPLAINåˆ†ææŸ¥è¯¢" class="headerlink" title="ğŸ”§ EXPLAINåˆ†ææŸ¥è¯¢"></a>ğŸ”§ EXPLAINåˆ†ææŸ¥è¯¢</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">100</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="string">&#x27;paid&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="EXPLAINå…³é”®å­—æ®µè§£è¯»"><a href="#EXPLAINå…³é”®å­—æ®µè§£è¯»" class="headerlink" title="EXPLAINå…³é”®å­—æ®µè§£è¯»"></a>EXPLAINå…³é”®å­—æ®µè§£è¯»</h3><table><thead><tr><th>å­—æ®µ</th><th>è¯´æ˜</th><th>ä¼˜åŒ–ç›®æ ‡</th></tr></thead><tbody><tr><td><strong>type</strong></td><td>è®¿é—®ç±»å‹</td><td>system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL</td></tr><tr><td><strong>key</strong></td><td>å®é™…ä½¿ç”¨çš„ç´¢å¼•</td><td>åº”è¯¥ä½¿ç”¨é¢„æœŸçš„ç´¢å¼•</td></tr><tr><td><strong>rows</strong></td><td>é¢„ä¼°æ‰«æè¡Œæ•°</td><td>è¶Šå°è¶Šå¥½</td></tr><tr><td><strong>Extra</strong></td><td>é¢å¤–ä¿¡æ¯</td><td>é¿å…Using filesort, Using temporary</td></tr></tbody></table><h3 id="typeç±»å‹è¯¦è§£"><a href="#typeç±»å‹è¯¦è§£" class="headerlink" title="typeç±»å‹è¯¦è§£"></a>typeç±»å‹è¯¦è§£</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- const: ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ref: æ™®é€šç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> username <span class="operator">=</span> <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- range: èŒƒå›´æŸ¥è¯¢</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">20</span> <span class="keyword">AND</span> <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ALL: å…¨è¡¨æ‰«æï¼ˆéœ€è¦ä¼˜åŒ–ï¼ï¼‰</span></span><br><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">+</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">25</span>;</span><br></pre></td></tr></table></figure><h2 id="âš ï¸-ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯"><a href="#âš ï¸-ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯" class="headerlink" title="âš ï¸ ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯"></a>âš ï¸ ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åœºæ™¯</h2><h3 id="1-å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°"><a href="#1-å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°" class="headerlink" title="1. å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°"></a>1. å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- âŒ ç´¢å¼•å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> <span class="keyword">YEAR</span>(create_time) <span class="operator">=</span> <span class="number">2024</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âœ… ä¼˜åŒ–å</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> create_time <span class="operator">&gt;=</span> <span class="string">&#x27;2024-01-01&#x27;</span> <span class="keyword">AND</span> create_time <span class="operator">&lt;</span> <span class="string">&#x27;2025-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="2-éšå¼ç±»å‹è½¬æ¢"><a href="#2-éšå¼ç±»å‹è½¬æ¢" class="headerlink" title="2. éšå¼ç±»å‹è½¬æ¢"></a>2. éšå¼ç±»å‹è½¬æ¢</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾ phone æ˜¯ VARCHAR ç±»å‹</span></span><br><span class="line"><span class="comment">-- âŒ ç´¢å¼•å¤±æ•ˆï¼ˆæ•°å­—ä¸å­—ç¬¦ä¸²æ¯”è¾ƒï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="number">13800138000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âœ… æ­£ç¡®å†™æ³•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> phone <span class="operator">=</span> <span class="string">&#x27;13800138000&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="3-LIKEä»¥é€šé…ç¬¦å¼€å¤´"><a href="#3-LIKEä»¥é€šé…ç¬¦å¼€å¤´" class="headerlink" title="3. LIKEä»¥é€šé…ç¬¦å¼€å¤´"></a>3. LIKEä»¥é€šé…ç¬¦å¼€å¤´</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- âŒ ç´¢å¼•å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;%å¼ &#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âœ… å¯ä»¥ä½¿ç”¨ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="keyword">LIKE</span> <span class="string">&#x27;å¼ %&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="4-ORæ¡ä»¶æœªå…¨éƒ¨å»ºç«‹ç´¢å¼•"><a href="#4-ORæ¡ä»¶æœªå…¨éƒ¨å»ºç«‹ç´¢å¼•" class="headerlink" title="4. ORæ¡ä»¶æœªå…¨éƒ¨å»ºç«‹ç´¢å¼•"></a>4. ORæ¡ä»¶æœªå…¨éƒ¨å»ºç«‹ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å‡è®¾åªæœ‰nameæœ‰ç´¢å¼•ï¼Œageæ²¡æœ‰</span></span><br><span class="line"><span class="comment">-- âŒ ç´¢å¼•å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span> <span class="keyword">OR</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âœ… è§£å†³æ–¹æ¡ˆ1ï¼šç»™ageä¹Ÿå»ºç´¢å¼•</span></span><br><span class="line"><span class="comment">-- âœ… è§£å†³æ–¹æ¡ˆ2ï¼šæ”¹ç”¨UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;å¼ ä¸‰&#x27;</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">=</span> <span class="number">25</span>;</span><br></pre></td></tr></table></figure><h3 id="5-ä¸ç­‰äºæ“ä½œ"><a href="#5-ä¸ç­‰äºæ“ä½œ" class="headerlink" title="5. ä¸ç­‰äºæ“ä½œ"></a>5. ä¸ç­‰äºæ“ä½œ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- âŒ å¯èƒ½ä¸èµ°ç´¢å¼•</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="operator">!=</span> <span class="string">&#x27;deleted&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âœ… å¦‚æœéåˆ é™¤æ•°æ®å å¤§å¤šæ•°ï¼Œå¯ä»¥æ”¹å†™</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> status <span class="keyword">IN</span> (<span class="string">&#x27;active&#x27;</span>, <span class="string">&#x27;pending&#x27;</span>, <span class="string">&#x27;blocked&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="ğŸ’¡-ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ"><a href="#ğŸ’¡-ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ" class="headerlink" title="ğŸ’¡ ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ"></a>ğŸ’¡ ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ</h2><h3 id="1-é€‰æ‹©æ€§é«˜çš„åˆ—ä¼˜å…ˆ"><a href="#1-é€‰æ‹©æ€§é«˜çš„åˆ—ä¼˜å…ˆ" class="headerlink" title="1. é€‰æ‹©æ€§é«˜çš„åˆ—ä¼˜å…ˆ"></a>1. é€‰æ‹©æ€§é«˜çš„åˆ—ä¼˜å…ˆ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- é€‰æ‹©æ€§ = ä¸é‡å¤å€¼æ•°é‡ / æ€»è¡Œæ•°</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> status) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> status_selectivity,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> user_id) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> user_id_selectivity</span><br><span class="line"><span class="keyword">FROM</span> orders;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- user_idé€‰æ‹©æ€§æ›´é«˜ï¼Œåº”è¯¥æ”¾åœ¨è”åˆç´¢å¼•å‰é¢</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_status <span class="keyword">ON</span> orders(user_id, status);</span><br></pre></td></tr></table></figure><h3 id="2-é¢‘ç¹æŸ¥è¯¢çš„åˆ—å»ºç´¢å¼•"><a href="#2-é¢‘ç¹æŸ¥è¯¢çš„åˆ—å»ºç´¢å¼•" class="headerlink" title="2. é¢‘ç¹æŸ¥è¯¢çš„åˆ—å»ºç´¢å¼•"></a>2. é¢‘ç¹æŸ¥è¯¢çš„åˆ—å»ºç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ‰¾å‡ºé«˜é¢‘æŸ¥è¯¢æ¡ä»¶</span></span><br><span class="line"><span class="comment">-- ä¸ºWHEREã€JOINã€ORDER BYã€GROUP BYæ¶‰åŠçš„åˆ—å»ºç´¢å¼•</span></span><br></pre></td></tr></table></figure><h3 id="3-æ§åˆ¶ç´¢å¼•æ•°é‡"><a href="#3-æ§åˆ¶ç´¢å¼•æ•°é‡" class="headerlink" title="3. æ§åˆ¶ç´¢å¼•æ•°é‡"></a>3. æ§åˆ¶ç´¢å¼•æ•°é‡</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- âŒ ç´¢å¼•è¿‡å¤šä¼šå½±å“å†™å…¥æ€§èƒ½</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_a <span class="keyword">ON</span> <span class="keyword">table</span>(a);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_b <span class="keyword">ON</span> <span class="keyword">table</span>(b);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_c <span class="keyword">ON</span> <span class="keyword">table</span>(c);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_ab <span class="keyword">ON</span> <span class="keyword">table</span>(a, b);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_bc <span class="keyword">ON</span> <span class="keyword">table</span>(b, c);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- âœ… åˆç†è®¾è®¡è”åˆç´¢å¼•ï¼Œä¸€ä¸ªç´¢å¼•è¦†ç›–å¤šä¸ªæŸ¥è¯¢åœºæ™¯</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_abc <span class="keyword">ON</span> <span class="keyword">table</span>(a, b, c);</span><br></pre></td></tr></table></figure><h3 id="4-é•¿å­—ç¬¦ä¸²ä½¿ç”¨å‰ç¼€ç´¢å¼•"><a href="#4-é•¿å­—ç¬¦ä¸²ä½¿ç”¨å‰ç¼€ç´¢å¼•" class="headerlink" title="4. é•¿å­—ç¬¦ä¸²ä½¿ç”¨å‰ç¼€ç´¢å¼•"></a>4. é•¿å­—ç¬¦ä¸²ä½¿ç”¨å‰ç¼€ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- å¯¹äºé•¿å­—ç¬¦ä¸²ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•èŠ‚çœç©ºé—´</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_email_prefix <span class="keyword">ON</span> users(email(<span class="number">10</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- é€‰æ‹©åˆé€‚çš„å‰ç¼€é•¿åº¦</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(email, <span class="number">5</span>)) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> len5,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(email, <span class="number">10</span>)) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> len10,</span><br><span class="line">    <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">LEFT</span>(email, <span class="number">15</span>)) <span class="operator">/</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> len15</span><br><span class="line"><span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure><h2 id="ğŸ“Š-å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†è®¢å•è¡¨ä¼˜åŒ–"><a href="#ğŸ“Š-å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†è®¢å•è¡¨ä¼˜åŒ–" class="headerlink" title="ğŸ“Š å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†è®¢å•è¡¨ä¼˜åŒ–"></a>ğŸ“Š å®æˆ˜æ¡ˆä¾‹ï¼šç”µå•†è®¢å•è¡¨ä¼˜åŒ–</h2><h3 id="åŸå§‹è¡¨ç»“æ„"><a href="#åŸå§‹è¡¨ç»“æ„" class="headerlink" title="åŸå§‹è¡¨ç»“æ„"></a>åŸå§‹è¡¨ç»“æ„</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> orders (</span><br><span class="line">    id <span class="type">BIGINT</span> <span class="keyword">PRIMARY KEY</span> AUTO_INCREMENT,</span><br><span class="line">    order_no <span class="type">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    user_id <span class="type">BIGINT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    product_id <span class="type">BIGINT</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    amount <span class="type">DECIMAL</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    status TINYINT <span class="keyword">NOT NULL</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">    create_time DATETIME <span class="keyword">NOT NULL</span>,</span><br><span class="line">    update_time DATETIME <span class="keyword">NOT NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="å¸¸è§æŸ¥è¯¢åœºæ™¯åˆ†æ"><a href="#å¸¸è§æŸ¥è¯¢åœºæ™¯åˆ†æ" class="headerlink" title="å¸¸è§æŸ¥è¯¢åœºæ™¯åˆ†æ"></a>å¸¸è§æŸ¥è¯¢åœºæ™¯åˆ†æ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœºæ™¯1ï¼šæ ¹æ®è®¢å•å·æŸ¥è¯¢ï¼ˆé«˜é¢‘ï¼Œéœ€è¦å¿«é€Ÿå®šä½ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> order_no <span class="operator">=</span> <span class="string">&#x27;ORD202412010001&#x27;</span>;</span><br><span class="line"><span class="comment">-- å»ºè®®ï¼šå”¯ä¸€ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_order_no <span class="keyword">ON</span> orders(order_no);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœºæ™¯2ï¼šæŸ¥è¯¢ç”¨æˆ·çš„è®¢å•åˆ—è¡¨ï¼ˆé«˜é¢‘ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> user_id <span class="operator">=</span> <span class="number">100</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> create_time <span class="keyword">DESC</span>;</span><br><span class="line"><span class="comment">-- å»ºè®®ï¼šè”åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_time <span class="keyword">ON</span> orders(user_id, create_time <span class="keyword">DESC</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœºæ™¯3ï¼šåå°æŸ¥è¯¢æŸçŠ¶æ€çš„è®¢å•ï¼ˆä¸­é¢‘ï¼‰</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> create_time <span class="operator">&gt;</span> <span class="string">&#x27;2024-12-01&#x27;</span>;</span><br><span class="line"><span class="comment">-- å»ºè®®ï¼šè”åˆç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_status_time <span class="keyword">ON</span> orders(status, create_time);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åœºæ™¯4ï¼šç»Ÿè®¡æŸå•†å“çš„é”€å”®é¢</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(amount) <span class="keyword">FROM</span> orders <span class="keyword">WHERE</span> product_id <span class="operator">=</span> <span class="number">500</span> <span class="keyword">AND</span> status <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="comment">-- å»ºè®®ï¼šè”åˆç´¢å¼• + è¦†ç›–ç´¢å¼•</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_product_status_amount <span class="keyword">ON</span> orders(product_id, status, amount);</span><br></pre></td></tr></table></figure><h3 id="æœ€ç»ˆç´¢å¼•è®¾è®¡"><a href="#æœ€ç»ˆç´¢å¼•è®¾è®¡" class="headerlink" title="æœ€ç»ˆç´¢å¼•è®¾è®¡"></a>æœ€ç»ˆç´¢å¼•è®¾è®¡</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç²¾ç®€åçš„ç´¢å¼•æ–¹æ¡ˆ</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_order_no <span class="keyword">ON</span> orders(order_no);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_time <span class="keyword">ON</span> orders(user_id, create_time <span class="keyword">DESC</span>);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_status_time <span class="keyword">ON</span> orders(status, create_time);</span><br><span class="line"><span class="keyword">CREATE</span> INDEX idx_product_status <span class="keyword">ON</span> orders(product_id, status);</span><br></pre></td></tr></table></figure><h2 id="ğŸ”-æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹"><a href="#ğŸ”-æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹" class="headerlink" title="ğŸ” æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹"></a>ğŸ” æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span><br><span class="line">   â†“</span><br><span class="line">2. åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œæ‰¾å‡ºé—®é¢˜SQL</span><br><span class="line">   â†“</span><br><span class="line">3. ä½¿ç”¨EXPLAINåˆ†ææ‰§è¡Œè®¡åˆ’</span><br><span class="line">   â†“</span><br><span class="line">4. æ£€æŸ¥æ˜¯å¦ç¼ºå°‘ç´¢å¼•æˆ–ç´¢å¼•å¤±æ•ˆ</span><br><span class="line">   â†“</span><br><span class="line">5. ä¼˜åŒ–SQLæˆ–æ·»åŠ /è°ƒæ•´ç´¢å¼•</span><br><span class="line">   â†“</span><br><span class="line">6. æµ‹è¯•éªŒè¯ä¼˜åŒ–æ•ˆæœ</span><br></pre></td></tr></table></figure><h3 id="å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—"><a href="#å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—" class="headerlink" title="å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—"></a>å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹å½“å‰é…ç½®</span></span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;slow_query%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;long_query_time&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> slow_query_log <span class="operator">=</span> <span class="string">&#x27;ON&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> long_query_time <span class="operator">=</span> <span class="number">1</span>;  <span class="comment">-- è¶…è¿‡1ç§’çš„æŸ¥è¯¢è®°å½•</span></span><br></pre></td></tr></table></figure><h2 id="ğŸš€-æ€»ç»“"><a href="#ğŸš€-æ€»ç»“" class="headerlink" title="ğŸš€ æ€»ç»“"></a>ğŸš€ æ€»ç»“</h2><h3 id="ç´¢å¼•ä¼˜åŒ–å£è¯€"><a href="#ç´¢å¼•ä¼˜åŒ–å£è¯€" class="headerlink" title="ç´¢å¼•ä¼˜åŒ–å£è¯€"></a>ç´¢å¼•ä¼˜åŒ–å£è¯€</h3><ol><li><strong>æœ€å·¦å‰ç¼€è¦ç‰¢è®°</strong>ï¼Œè”åˆç´¢å¼•æŒ‰é¡ºåº</li><li><strong>è¦†ç›–ç´¢å¼•å‡å›è¡¨</strong>ï¼ŒæŸ¥è¯¢æ•ˆç‡å¤§æå‡</li><li><strong>å‡½æ•°è¿ç®—è¦é¿å…</strong>ï¼Œç´¢å¼•åˆ—ä¿æŒåŸæ ·</li><li><strong>ç±»å‹è½¬æ¢æ˜¯å¤§å‘</strong>ï¼Œå­—æ®µç±»å‹è¦åŒ¹é…</li><li><strong>é€‰æ‹©æ€§é«˜æ”¾å‰é¢</strong>ï¼ŒåŒºåˆ†åº¦å¤§æ›´æœ‰æ•ˆ</li></ol><h3 id="æ€§èƒ½ä¼˜åŒ–checklist"><a href="#æ€§èƒ½ä¼˜åŒ–checklist" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–checklist"></a>æ€§èƒ½ä¼˜åŒ–checklist</h3><ul><li>âœ… ä¸ºé«˜é¢‘æŸ¥è¯¢æ¡ä»¶å»ºç«‹ç´¢å¼•</li><li>âœ… ä½¿ç”¨EXPLAINéªŒè¯ç´¢å¼•ä½¿ç”¨æƒ…å†µ</li><li>âœ… é¿å…ç´¢å¼•å¤±æ•ˆçš„å†™æ³•</li><li>âœ… å®šæœŸåˆ†æå’Œä¼˜åŒ–æ…¢æŸ¥è¯¢</li><li>âœ… æ§åˆ¶å•è¡¨ç´¢å¼•æ•°é‡ï¼ˆå»ºè®®ä¸è¶…è¿‡5-6ä¸ªï¼‰</li></ul><hr><p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµåˆ†äº«ï¼</strong> ğŸ’ª</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“æŠ€æœ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> MySQL </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> ç´¢å¼• </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gitå·¥ä½œæµä¸å›¢é˜Ÿåä½œæœ€ä½³å®è·µ</title>
      <link href="/2025/08/10/Git%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%8E%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
      <url>/2025/08/10/Git%E5%B7%A5%E4%BD%9C%E6%B5%81%E4%B8%8E%E5%9B%A2%E9%98%9F%E5%8D%8F%E4%BD%9C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="Gitå·¥ä½œæµä¸å›¢é˜Ÿåä½œæœ€ä½³å®è·µ"><a href="#Gitå·¥ä½œæµä¸å›¢é˜Ÿåä½œæœ€ä½³å®è·µ" class="headerlink" title="Gitå·¥ä½œæµä¸å›¢é˜Ÿåä½œæœ€ä½³å®è·µ"></a>Gitå·¥ä½œæµä¸å›¢é˜Ÿåä½œæœ€ä½³å®è·µ</h1><blockquote><p>ğŸ”€ <strong>ä½ å°†å­¦åˆ°</strong></p><ul><li>Gitæ ¸å¿ƒæ¦‚å¿µå’Œå¸¸ç”¨å‘½ä»¤</li><li>ä¸»æµGitå·¥ä½œæµå¯¹æ¯”ä¸é€‰æ‹©</li><li>ä»£ç å®¡æŸ¥ä¸åˆå¹¶ç­–ç•¥</li><li>è§£å†³å†²çªçš„æŠ€å·§</li></ul></blockquote><h2 id="ğŸ¯-GitåŸºç¡€å›é¡¾"><a href="#ğŸ¯-GitåŸºç¡€å›é¡¾" class="headerlink" title="ğŸ¯ GitåŸºç¡€å›é¡¾"></a>ğŸ¯ GitåŸºç¡€å›é¡¾</h2><h3 id="æ ¸å¿ƒæ¦‚å¿µå›¾è§£"><a href="#æ ¸å¿ƒæ¦‚å¿µå›¾è§£" class="headerlink" title="æ ¸å¿ƒæ¦‚å¿µå›¾è§£"></a>æ ¸å¿ƒæ¦‚å¿µå›¾è§£</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å·¥ä½œåŒº(Working Directory)</span><br><span class="line">    â†“ git add</span><br><span class="line">æš‚å­˜åŒº(Staging Area)  </span><br><span class="line">    â†“ git commit</span><br><span class="line">æœ¬åœ°ä»“åº“(Local Repository)</span><br><span class="line">    â†“ git push</span><br><span class="line">è¿œç¨‹ä»“åº“(Remote Repository)</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥"><a href="#å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥" class="headerlink" title="å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥"></a>å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆå§‹åŒ–ä¸å…‹éš†</span></span><br><span class="line">git init                      <span class="comment"># åˆå§‹åŒ–ä»“åº“</span></span><br><span class="line">git <span class="built_in">clone</span> &lt;url&gt;               <span class="comment"># å…‹éš†è¿œç¨‹ä»“åº“</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ—¥å¸¸æ“ä½œ</span></span><br><span class="line">git status                    <span class="comment"># æŸ¥çœ‹çŠ¶æ€</span></span><br><span class="line">git add .                     <span class="comment"># æ·»åŠ æ‰€æœ‰ä¿®æ”¹åˆ°æš‚å­˜åŒº</span></span><br><span class="line">git commit -m <span class="string">&quot;message&quot;</span>       <span class="comment"># æäº¤</span></span><br><span class="line">git push origin main          <span class="comment"># æ¨é€åˆ°è¿œç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ†æ”¯æ“ä½œ</span></span><br><span class="line">git branch                    <span class="comment"># æŸ¥çœ‹åˆ†æ”¯</span></span><br><span class="line">git branch feature-x          <span class="comment"># åˆ›å»ºåˆ†æ”¯</span></span><br><span class="line">git checkout feature-x        <span class="comment"># åˆ‡æ¢åˆ†æ”¯</span></span><br><span class="line">git checkout -b feature-x     <span class="comment"># åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯</span></span><br><span class="line">git merge feature-x           <span class="comment"># åˆå¹¶åˆ†æ”¯</span></span><br><span class="line">git branch -d feature-x       <span class="comment"># åˆ é™¤åˆ†æ”¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å†å²</span></span><br><span class="line">git <span class="built_in">log</span> --oneline --graph     <span class="comment"># å›¾å½¢åŒ–æŸ¥çœ‹æäº¤å†å²</span></span><br><span class="line">git diff                      <span class="comment"># æŸ¥çœ‹ä¿®æ”¹å†…å®¹</span></span><br><span class="line">git blame &lt;file&gt;              <span class="comment"># æŸ¥çœ‹æ–‡ä»¶æ¯è¡Œçš„ä¿®æ”¹è€…</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ’¤é”€æ“ä½œ</span></span><br><span class="line">git checkout -- &lt;file&gt;        <span class="comment"># æ’¤é”€å·¥ä½œåŒºä¿®æ”¹</span></span><br><span class="line">git reset HEAD &lt;file&gt;         <span class="comment"># å–æ¶ˆæš‚å­˜</span></span><br><span class="line">git reset --soft HEAD~1       <span class="comment"># æ’¤é”€ä¸Šæ¬¡æäº¤(ä¿ç•™ä¿®æ”¹)</span></span><br><span class="line">git reset --hard HEAD~1       <span class="comment"># æ’¤é”€ä¸Šæ¬¡æäº¤(ä¸¢å¼ƒä¿®æ”¹)</span></span><br><span class="line">git revert &lt;commit&gt;           <span class="comment"># åˆ›å»ºä¸€ä¸ªæ’¤é”€æäº¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‚¨è—</span></span><br><span class="line">git stash                     <span class="comment"># å‚¨è—å½“å‰ä¿®æ”¹</span></span><br><span class="line">git stash pop                 <span class="comment"># æ¢å¤å‚¨è—</span></span><br><span class="line">git stash list                <span class="comment"># æŸ¥çœ‹å‚¨è—åˆ—è¡¨</span></span><br></pre></td></tr></table></figure><h2 id="ğŸ”„-ä¸»æµGitå·¥ä½œæµ"><a href="#ğŸ”„-ä¸»æµGitå·¥ä½œæµ" class="headerlink" title="ğŸ”„ ä¸»æµGitå·¥ä½œæµ"></a>ğŸ”„ ä¸»æµGitå·¥ä½œæµ</h2><h3 id="1-Git-Flow"><a href="#1-Git-Flow" class="headerlink" title="1. Git Flow"></a>1. Git Flow</h3><p>é€‚ç”¨äº<strong>å‘å¸ƒå‘¨æœŸå›ºå®š</strong>çš„é¡¹ç›®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">main â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â†’</span><br><span class="line">          â”‚               â†‘             â†‘</span><br><span class="line">          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br><span class="line">          â†“    â”‚              â”‚</span><br><span class="line">develop â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â†’</span><br><span class="line">               â”‚    â†‘    â”‚         â†‘</span><br><span class="line">               â”‚    â”‚    â”‚         â”‚</span><br><span class="line">feature/a â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”˜    â”‚         â”‚</span><br><span class="line">                         â”‚         â”‚</span><br><span class="line">feature/b â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p><strong>åˆ†æ”¯è¯´æ˜</strong>ï¼š</p><ul><li><code>main</code>: ç”Ÿäº§ç¯å¢ƒä»£ç </li><li><code>develop</code>: å¼€å‘ä¸»åˆ†æ”¯</li><li><code>feature/*</code>: åŠŸèƒ½åˆ†æ”¯</li><li><code>release/*</code>: å‘å¸ƒåˆ†æ”¯</li><li><code>hotfix/*</code>: ç´§æ€¥ä¿®å¤åˆ†æ”¯</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Git Flow å·¥ä½œæµç¨‹ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># 1. å¼€å§‹æ–°åŠŸèƒ½</span></span><br><span class="line">git checkout develop</span><br><span class="line">git checkout -b feature/user-login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¼€å‘å®Œæˆååˆå¹¶</span></span><br><span class="line">git checkout develop</span><br><span class="line">git merge --no-ff feature/user-login</span><br><span class="line">git branch -d feature/user-login</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å‡†å¤‡å‘å¸ƒ</span></span><br><span class="line">git checkout -b release/v1.0.0</span><br><span class="line"><span class="comment"># è¿›è¡Œå‘å¸ƒå‰æµ‹è¯•å’Œä¿®å¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å‘å¸ƒ</span></span><br><span class="line">git checkout main</span><br><span class="line">git merge --no-ff release/v1.0.0</span><br><span class="line">git tag -a v1.0.0 -m <span class="string">&quot;Release v1.0.0&quot;</span></span><br><span class="line"></span><br><span class="line">git checkout develop</span><br><span class="line">git merge --no-ff release/v1.0.0</span><br><span class="line">git branch -d release/v1.0.0</span><br></pre></td></tr></table></figure><h3 id="2-GitHub-Flow"><a href="#2-GitHub-Flow" class="headerlink" title="2. GitHub Flow"></a>2. GitHub Flow</h3><p>é€‚ç”¨äº<strong>æŒç»­éƒ¨ç½²</strong>çš„é¡¹ç›®ï¼Œç®€å•é«˜æ•ˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">main â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â†’</span><br><span class="line">          â”‚       â†‘       â”‚       â†‘</span><br><span class="line">          â”‚       â”‚       â”‚       â”‚</span><br><span class="line">feature â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”˜       â”‚       â”‚</span><br><span class="line">                          â”‚       â”‚</span><br><span class="line">bugfix â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><p><strong>æµç¨‹</strong>ï¼š</p><ol><li>ä»mainåˆ›å»ºåˆ†æ”¯</li><li>å¼€å‘å¹¶æäº¤</li><li>åˆ›å»ºPull Request</li><li>ä»£ç å®¡æŸ¥</li><li>åˆå¹¶åˆ°mainå¹¶éƒ¨ç½²</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GitHub Flow ç¤ºä¾‹</span></span><br><span class="line"><span class="comment"># 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯</span></span><br><span class="line">git checkout main</span><br><span class="line">git pull origin main</span><br><span class="line">git checkout -b feature/shopping-cart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å¼€å‘æäº¤</span></span><br><span class="line">git add .</span><br><span class="line">git commit -m <span class="string">&quot;feat: add shopping cart functionality&quot;</span></span><br><span class="line">git push origin feature/shopping-cart</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. åœ¨GitHubä¸Šåˆ›å»ºPRï¼Œé€šè¿‡å®¡æŸ¥ååˆå¹¶</span></span><br><span class="line"><span class="comment"># 4. åˆ é™¤åŠŸèƒ½åˆ†æ”¯</span></span><br><span class="line">git checkout main</span><br><span class="line">git pull origin main</span><br><span class="line">git branch -d feature/shopping-cart</span><br></pre></td></tr></table></figure><h3 id="3-Trunk-Based-Development"><a href="#3-Trunk-Based-Development" class="headerlink" title="3. Trunk-Based Development"></a>3. Trunk-Based Development</h3><p>é€‚ç”¨äº<strong>é«˜åº¦è‡ªåŠ¨åŒ–æµ‹è¯•</strong>çš„å›¢é˜Ÿã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">main â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â†’</span><br><span class="line">          â”‚   â”‚   â”‚   â”‚   â”‚   â”‚   â”‚</span><br><span class="line">         çŸ­æœŸåˆ†æ”¯(å°æ—¶çº§åˆ«)</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong>ï¼š</p><ul><li>æ‰€æœ‰å¼€å‘è€…ç›´æ¥å‘mainæäº¤</li><li>åˆ†æ”¯ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼ˆå‡ å°æ—¶åˆ°1å¤©ï¼‰</li><li>ä¾èµ–Feature Flagæ§åˆ¶åŠŸèƒ½å‘å¸ƒ</li></ul><h2 id="ğŸ“-Commit-Messageè§„èŒƒ"><a href="#ğŸ“-Commit-Messageè§„èŒƒ" class="headerlink" title="ğŸ“ Commit Messageè§„èŒƒ"></a>ğŸ“ Commit Messageè§„èŒƒ</h2><h3 id="Conventional-Commitsæ ¼å¼"><a href="#Conventional-Commitsæ ¼å¼" class="headerlink" title="Conventional Commitsæ ¼å¼"></a>Conventional Commitsæ ¼å¼</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure><h3 id="Typeç±»å‹"><a href="#Typeç±»å‹" class="headerlink" title="Typeç±»å‹"></a>Typeç±»å‹</h3><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>feat</code></td><td>æ–°åŠŸèƒ½</td><td>feat: æ·»åŠ ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½</td></tr><tr><td><code>fix</code></td><td>Bugä¿®å¤</td><td>fix: ä¿®å¤ç™»å½•éªŒè¯ç å¤±æ•ˆé—®é¢˜</td></tr><tr><td><code>docs</code></td><td>æ–‡æ¡£æ›´æ–°</td><td>docs: æ›´æ–°APIæ–‡æ¡£</td></tr><tr><td><code>style</code></td><td>ä»£ç æ ¼å¼</td><td>style: æ ¼å¼åŒ–ä»£ç </td></tr><tr><td><code>refactor</code></td><td>é‡æ„</td><td>refactor: é‡æ„ç”¨æˆ·æ¨¡å—</td></tr><tr><td><code>perf</code></td><td>æ€§èƒ½ä¼˜åŒ–</td><td>perf: ä¼˜åŒ–é¦–é¡µåŠ è½½é€Ÿåº¦</td></tr><tr><td><code>test</code></td><td>æµ‹è¯•</td><td>test: æ·»åŠ å•å…ƒæµ‹è¯•</td></tr><tr><td><code>chore</code></td><td>æ„å»º&#x2F;å·¥å…·</td><td>chore: æ›´æ–°ä¾èµ–ç‰ˆæœ¬</td></tr></tbody></table><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¥½çš„æäº¤ä¿¡æ¯</span></span><br><span class="line">git commit -m <span class="string">&quot;feat(auth): æ·»åŠ JWT tokenåˆ·æ–°æœºåˆ¶</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">- å®ç°tokenè‡ªåŠ¨åˆ·æ–°</span></span><br><span class="line"><span class="string">- æ·»åŠ tokenè¿‡æœŸå‰5åˆ†é’Ÿè‡ªåŠ¨ç»­æœŸ</span></span><br><span class="line"><span class="string">- ä¿®æ”¹ç™»å½•æ¥å£è¿”å›refresh_token</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Closes #123&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸å¥½çš„æäº¤ä¿¡æ¯</span></span><br><span class="line">git commit -m <span class="string">&quot;ä¿®æ”¹äº†ä¸€äº›ä»£ç &quot;</span></span><br><span class="line">git commit -m <span class="string">&quot;update&quot;</span></span><br><span class="line">git commit -m <span class="string">&quot;fix bug&quot;</span></span><br></pre></td></tr></table></figure><h2 id="ğŸ”€-åˆå¹¶ç­–ç•¥"><a href="#ğŸ”€-åˆå¹¶ç­–ç•¥" class="headerlink" title="ğŸ”€ åˆå¹¶ç­–ç•¥"></a>ğŸ”€ åˆå¹¶ç­–ç•¥</h2><h3 id="1-Merge-Commit"><a href="#1-Merge-Commit" class="headerlink" title="1. Merge Commit"></a>1. Merge Commit</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout main</span><br><span class="line">git merge --no-ff feature/xxx</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      A---B---C  feature</span><br><span class="line">     /         \</span><br><span class="line">D---E-----------F  main (merge commit)</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼šä¿ç•™å®Œæ•´å†å²ï¼Œå¯è¿½æº¯<br><strong>ç¼ºç‚¹</strong>ï¼šå†å²è®°å½•è¾ƒå¤š</p><h3 id="2-Squash-Merge"><a href="#2-Squash-Merge" class="headerlink" title="2. Squash Merge"></a>2. Squash Merge</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git checkout main</span><br><span class="line">git merge --squash feature/xxx</span><br><span class="line">git commit -m <span class="string">&quot;feat: add new feature&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A---B---C  feature</span><br><span class="line"></span><br><span class="line">D---E---F  main (squashæˆä¸€ä¸ªæäº¤)</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼šå†å²ç®€æ´<br><strong>ç¼ºç‚¹</strong>ï¼šä¸¢å¤±è¯¦ç»†æäº¤è®°å½•</p><h3 id="3-Rebase"><a href="#3-Rebase" class="headerlink" title="3. Rebase"></a>3. Rebase</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature/xxx</span><br><span class="line">git rebase main</span><br><span class="line">git checkout main</span><br><span class="line">git merge feature/xxx</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      A---B---C  feature (before rebase)</span><br><span class="line"></span><br><span class="line">D---E---A&#x27;---B&#x27;---C&#x27;  main (after rebase + merge)</span><br></pre></td></tr></table></figure><p><strong>ä¼˜ç‚¹</strong>ï¼šçº¿æ€§å†å²ï¼Œæ•´æ´<br><strong>ç¼ºç‚¹</strong>ï¼šæ”¹å†™å†å²ï¼Œéœ€è°¨æ…ä½¿ç”¨</p><h2 id="âš”ï¸-è§£å†³å†²çª"><a href="#âš”ï¸-è§£å†³å†²çª" class="headerlink" title="âš”ï¸ è§£å†³å†²çª"></a>âš”ï¸ è§£å†³å†²çª</h2><h3 id="å†²çªç¤ºä¾‹"><a href="#å†²çªç¤ºä¾‹" class="headerlink" title="å†²çªç¤ºä¾‹"></a>å†²çªç¤ºä¾‹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line">console.log(&quot;è¿™æ˜¯mainåˆ†æ”¯çš„ä»£ç &quot;);</span><br><span class="line">=======</span><br><span class="line">console.log(&quot;è¿™æ˜¯featureåˆ†æ”¯çš„ä»£ç &quot;);</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature/xxx</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ­¥éª¤"><a href="#è§£å†³æ­¥éª¤" class="headerlink" title="è§£å†³æ­¥éª¤"></a>è§£å†³æ­¥éª¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. æ‹‰å–æœ€æ–°ä»£ç </span></span><br><span class="line">git fetch origin</span><br><span class="line">git checkout feature/xxx</span><br><span class="line">git rebase origin/main</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å‡ºç°å†²çªæ—¶ï¼Œæ‰‹åŠ¨ç¼–è¾‘æ–‡ä»¶è§£å†³</span></span><br><span class="line"><span class="comment"># 3. æ ‡è®°å†²çªå·²è§£å†³</span></span><br><span class="line">git add &lt;conflicted-file&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. ç»§ç»­rebase</span></span><br><span class="line">git rebase --<span class="built_in">continue</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. å¦‚æœæƒ³æ”¾å¼ƒ</span></span><br><span class="line">git rebase --abort</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨VS-Codeè§£å†³å†²çª"><a href="#ä½¿ç”¨VS-Codeè§£å†³å†²çª" class="headerlink" title="ä½¿ç”¨VS Codeè§£å†³å†²çª"></a>ä½¿ç”¨VS Codeè§£å†³å†²çª</h3><p>VS Codeæä¾›äº†ç›´è§‚çš„å†²çªè§£å†³ç•Œé¢ï¼š</p><ul><li><strong>Accept Current Change</strong>: ä¿ç•™å½“å‰åˆ†æ”¯ä¿®æ”¹</li><li><strong>Accept Incoming Change</strong>: ä½¿ç”¨åˆå¹¶è¿›æ¥çš„ä¿®æ”¹</li><li><strong>Accept Both Changes</strong>: ä¿ç•™ä¸¤è€…</li><li><strong>Compare Changes</strong>: å¯¹æ¯”æŸ¥çœ‹å·®å¼‚</li></ul><h2 id="ğŸ›¡ï¸-ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ"><a href="#ğŸ›¡ï¸-ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ" class="headerlink" title="ğŸ›¡ï¸ ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ"></a>ğŸ›¡ï¸ ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ</h2><h3 id="PR-MRæ£€æŸ¥æ¸…å•"><a href="#PR-MRæ£€æŸ¥æ¸…å•" class="headerlink" title="PR&#x2F;MRæ£€æŸ¥æ¸…å•"></a>PR&#x2F;MRæ£€æŸ¥æ¸…å•</h3><ul><li>âœ… ä»£ç ç¬¦åˆç¼–ç è§„èŒƒ</li><li>âœ… æœ‰è¶³å¤Ÿçš„æµ‹è¯•è¦†ç›–</li><li>âœ… æ²¡æœ‰æ•æ„Ÿä¿¡æ¯æ³„éœ²</li><li>âœ… æ€§èƒ½å½±å“å·²è¯„ä¼°</li><li>âœ… æ–‡æ¡£å·²æ›´æ–°</li><li>âœ… Commit messageè§„èŒƒ</li></ul><h3 id="å®¡æŸ¥è€…è¦ç‚¹"><a href="#å®¡æŸ¥è€…è¦ç‚¹" class="headerlink" title="å®¡æŸ¥è€…è¦ç‚¹"></a>å®¡æŸ¥è€…è¦ç‚¹</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">## å®¡æŸ¥é‡ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">1.</span> <span class="strong">**åŠŸèƒ½æ­£ç¡®æ€§**</span>: ä»£ç æ˜¯å¦å®ç°äº†é¢„æœŸåŠŸèƒ½ï¼Ÿ</span><br><span class="line"><span class="bullet">2.</span> <span class="strong">**ä»£ç è´¨é‡**</span>: æ˜¯å¦éµå¾ªè®¾è®¡åŸåˆ™ï¼Ÿæœ‰æ— ä»£ç å¼‚å‘³ï¼Ÿ</span><br><span class="line"><span class="bullet">3.</span> <span class="strong">**å®‰å…¨æ€§**</span>: æ˜¯å¦å­˜åœ¨å®‰å…¨æ¼æ´ï¼Ÿ</span><br><span class="line"><span class="bullet">4.</span> <span class="strong">**æ€§èƒ½**</span>: æ˜¯å¦æœ‰æ€§èƒ½é—®é¢˜ï¼Ÿ</span><br><span class="line"><span class="bullet">5.</span> <span class="strong">**å¯ç»´æŠ¤æ€§**</span>: ä»£ç æ˜¯å¦æ˜“äºç†è§£å’Œç»´æŠ¤ï¼Ÿ</span><br><span class="line"><span class="bullet">6.</span> <span class="strong">**æµ‹è¯•**</span>: æµ‹è¯•æ˜¯å¦å……åˆ†ï¼Ÿ</span><br></pre></td></tr></table></figure><h2 id="ğŸš€-å®ç”¨æŠ€å·§"><a href="#ğŸš€-å®ç”¨æŠ€å·§" class="headerlink" title="ğŸš€ å®ç”¨æŠ€å·§"></a>ğŸš€ å®ç”¨æŠ€å·§</h2><h3 id="1-äº¤äº’å¼Rebaseæ•´ç†æäº¤"><a href="#1-äº¤äº’å¼Rebaseæ•´ç†æäº¤" class="headerlink" title="1. äº¤äº’å¼Rebaseæ•´ç†æäº¤"></a>1. äº¤äº’å¼Rebaseæ•´ç†æäº¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ•´ç†æœ€è¿‘3æ¬¡æäº¤</span></span><br><span class="line">git rebase -i HEAD~3</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ç¼–è¾‘å™¨ä¸­å¯ä»¥ï¼š</span></span><br><span class="line"><span class="comment"># pick - ä¿ç•™æäº¤</span></span><br><span class="line"><span class="comment"># squash - åˆå¹¶åˆ°ä¸Šä¸€ä¸ªæäº¤</span></span><br><span class="line"><span class="comment"># reword - ä¿®æ”¹æäº¤ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># drop - åˆ é™¤æäº¤</span></span><br></pre></td></tr></table></figure><h3 id="2-Cherry-pické€‰æ‹©æ€§åˆå¹¶"><a href="#2-Cherry-pické€‰æ‹©æ€§åˆå¹¶" class="headerlink" title="2. Cherry-pické€‰æ‹©æ€§åˆå¹¶"></a>2. Cherry-pické€‰æ‹©æ€§åˆå¹¶</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†æŸä¸ªæäº¤åº”ç”¨åˆ°å½“å‰åˆ†æ”¯</span></span><br><span class="line">git cherry-pick &lt;commit-hash&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># åº”ç”¨å¤šä¸ªæäº¤</span></span><br><span class="line">git cherry-pick &lt;commit1&gt; &lt;commit2&gt;</span><br></pre></td></tr></table></figure><h3 id="3-BisectäºŒåˆ†æŸ¥æ‰¾Bug"><a href="#3-BisectäºŒåˆ†æŸ¥æ‰¾Bug" class="headerlink" title="3. BisectäºŒåˆ†æŸ¥æ‰¾Bug"></a>3. BisectäºŒåˆ†æŸ¥æ‰¾Bug</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å§‹äºŒåˆ†æŸ¥æ‰¾</span></span><br><span class="line">git bisect start</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ‡è®°å½“å‰ç‰ˆæœ¬æœ‰bug</span></span><br><span class="line">git bisect bad</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ‡è®°æŸä¸ªç‰ˆæœ¬æ­£å¸¸</span></span><br><span class="line">git bisect good v1.0.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># Gitä¼šè‡ªåŠ¨æ£€å‡ºä¸­é—´ç‰ˆæœ¬ï¼Œæµ‹è¯•åæ ‡è®°good/bad</span></span><br><span class="line"><span class="comment"># ç›´åˆ°æ‰¾åˆ°å¼•å…¥bugçš„æäº¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»“æŸ</span></span><br><span class="line">git bisect reset</span><br></pre></td></tr></table></figure><h3 id="4-é…ç½®åˆ«åæé«˜æ•ˆç‡"><a href="#4-é…ç½®åˆ«åæé«˜æ•ˆç‡" class="headerlink" title="4. é…ç½®åˆ«åæé«˜æ•ˆç‡"></a>4. é…ç½®åˆ«åæé«˜æ•ˆç‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ ~/.gitconfig æ·»åŠ </span></span><br><span class="line">[<span class="built_in">alias</span>]</span><br><span class="line">    st = status</span><br><span class="line">    co = checkout</span><br><span class="line">    br = branch</span><br><span class="line">    cm = commit -m</span><br><span class="line">    lg = <span class="built_in">log</span> --oneline --graph --decorate</span><br><span class="line">    unstage = reset HEAD --</span><br><span class="line">    last = <span class="built_in">log</span> -1 HEAD</span><br><span class="line">    visual = !gitk</span><br></pre></td></tr></table></figure><h2 id="ğŸ“Š-å›¢é˜Ÿåä½œè§„èŒƒæ¨¡æ¿"><a href="#ğŸ“Š-å›¢é˜Ÿåä½œè§„èŒƒæ¨¡æ¿" class="headerlink" title="ğŸ“Š å›¢é˜Ÿåä½œè§„èŒƒæ¨¡æ¿"></a>ğŸ“Š å›¢é˜Ÿåä½œè§„èŒƒæ¨¡æ¿</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># Gitåä½œè§„èŒƒ</span></span><br><span class="line"></span><br><span class="line"><span class="section">## åˆ†æ”¯å‘½å</span></span><br><span class="line"><span class="bullet">-</span> åŠŸèƒ½åˆ†æ”¯: feature/åŠŸèƒ½åç§°</span><br><span class="line"><span class="bullet">-</span> ä¿®å¤åˆ†æ”¯: fix/é—®é¢˜æè¿°</span><br><span class="line"><span class="bullet">-</span> çƒ­ä¿®å¤: hotfix/é—®é¢˜æè¿°</span><br><span class="line"></span><br><span class="line"><span class="section">## æäº¤è§„èŒƒ</span></span><br><span class="line"><span class="bullet">-</span> ä½¿ç”¨Conventional Commitsæ ¼å¼</span><br><span class="line"><span class="bullet">-</span> æ¯ä¸ªæäº¤åº”è¯¥æ˜¯åŸå­æ€§çš„</span><br><span class="line"><span class="bullet">-</span> ç¦æ­¢æäº¤æœªå®Œæˆçš„ä»£ç åˆ°ä¸»åˆ†æ”¯</span><br><span class="line"></span><br><span class="line"><span class="section">## ä»£ç å®¡æŸ¥</span></span><br><span class="line"><span class="bullet">-</span> æ‰€æœ‰ä»£ç å¿…é¡»ç»è¿‡è‡³å°‘1äººå®¡æŸ¥</span><br><span class="line"><span class="bullet">-</span> å®¡æŸ¥é€šè¿‡åæ‰èƒ½åˆå¹¶</span><br><span class="line"><span class="bullet">-</span> åˆå¹¶å‰éœ€è¦é€šè¿‡CIæ£€æŸ¥</span><br><span class="line"></span><br><span class="line"><span class="section">## å‘å¸ƒæµç¨‹</span></span><br><span class="line"><span class="bullet">1.</span> åˆ›å»ºreleaseåˆ†æ”¯</span><br><span class="line"><span class="bullet">2.</span> æµ‹è¯•éªŒè¯</span><br><span class="line"><span class="bullet">3.</span> åˆå¹¶åˆ°mainå¹¶æ‰“tag</span><br><span class="line"><span class="bullet">4.</span> åŒæ­¥åˆ°develop</span><br></pre></td></tr></table></figure><hr><p><strong>æŒæ¡Gitï¼Œè®©å›¢é˜Ÿåä½œæ›´é«˜æ•ˆï¼</strong> ğŸ‰</p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> ç‰ˆæœ¬æ§åˆ¶ </tag>
            
            <tag> å›¢é˜Ÿåä½œ </tag>
            
            <tag> DevOps </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»åŠ è½½åˆ°æ¸²æŸ“å…¨é¢æé€Ÿ</title>
      <link href="/2025/07/05/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98/"/>
      <url>/2025/07/05/%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»åŠ è½½åˆ°æ¸²æŸ“å…¨é¢æé€Ÿ"><a href="#å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»åŠ è½½åˆ°æ¸²æŸ“å…¨é¢æé€Ÿ" class="headerlink" title="å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»åŠ è½½åˆ°æ¸²æŸ“å…¨é¢æé€Ÿ"></a>å‰ç«¯æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šä»åŠ è½½åˆ°æ¸²æŸ“å…¨é¢æé€Ÿ</h1><blockquote><p>âš¡ <strong>æ€§èƒ½ä¼˜åŒ–æ ¸å¿ƒç›®æ ‡</strong></p><ul><li>é¦–å±åŠ è½½æ—¶é—´ &lt; 2ç§’</li><li>å¯äº¤äº’æ—¶é—´ (TTI) &lt; 3ç§’</li><li>é¡µé¢æµç•…åº¦ 60fps</li></ul></blockquote><h2 id="ğŸ“Š-æ€§èƒ½æŒ‡æ ‡è§£è¯»"><a href="#ğŸ“Š-æ€§èƒ½æŒ‡æ ‡è§£è¯»" class="headerlink" title="ğŸ“Š æ€§èƒ½æŒ‡æ ‡è§£è¯»"></a>ğŸ“Š æ€§èƒ½æŒ‡æ ‡è§£è¯»</h2><h3 id="Core-Web-Vitals"><a href="#Core-Web-Vitals" class="headerlink" title="Core Web Vitals"></a>Core Web Vitals</h3><table><thead><tr><th>æŒ‡æ ‡</th><th>è¯´æ˜</th><th>ä¼˜ç§€æ ‡å‡†</th></tr></thead><tbody><tr><td><strong>LCP</strong></td><td>æœ€å¤§å†…å®¹ç»˜åˆ¶</td><td>&lt; 2.5s</td></tr><tr><td><strong>FID</strong></td><td>é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ</td><td>&lt; 100ms</td></tr><tr><td><strong>CLS</strong></td><td>ç´¯è®¡å¸ƒå±€åç§»</td><td>&lt; 0.1</td></tr></tbody></table><h2 id="ğŸš€-èµ„æºåŠ è½½ä¼˜åŒ–"><a href="#ğŸš€-èµ„æºåŠ è½½ä¼˜åŒ–" class="headerlink" title="ğŸš€ èµ„æºåŠ è½½ä¼˜åŒ–"></a>ğŸš€ èµ„æºåŠ è½½ä¼˜åŒ–</h2><h3 id="1-å›¾ç‰‡ä¼˜åŒ–"><a href="#1-å›¾ç‰‡ä¼˜åŒ–" class="headerlink" title="1. å›¾ç‰‡ä¼˜åŒ–"></a>1. å›¾ç‰‡ä¼˜åŒ–</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä½¿ç”¨WebPæ ¼å¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;image.webp&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/webp&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;image.jpg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/jpeg&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;image.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;æè¿°&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å“åº”å¼å›¾ç‰‡ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> </span></span><br><span class="line"><span class="tag">  <span class="attr">srcset</span>=<span class="string">&quot;small.jpg 480w, medium.jpg 800w, large.jpg 1200w&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">sizes</span>=<span class="string">&quot;(max-width: 600px) 480px, (max-width: 1000px) 800px, 1200px&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">src</span>=<span class="string">&quot;large.jpg&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">alt</span>=<span class="string">&quot;å“åº”å¼å›¾ç‰‡&quot;</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æ‡’åŠ è½½ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;placeholder.jpg&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;real-image.jpg&quot;</span> <span class="attr">loading</span>=<span class="string">&quot;lazy&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;æ‡’åŠ è½½å›¾ç‰‡&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-JavaScriptä¼˜åŒ–"><a href="#2-JavaScriptä¼˜åŒ–" class="headerlink" title="2. JavaScriptä¼˜åŒ–"></a>2. JavaScriptä¼˜åŒ–</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¼‚æ­¥åŠ è½½éå…³é”®è„šæœ¬ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;analytics.js&quot;</span> <span class="attr">async</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- å»¶è¿ŸåŠ è½½ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;non-critical.js&quot;</span> <span class="attr">defer</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- é¢„åŠ è½½å…³é”®èµ„æº --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;critical.js&quot;</span> <span class="attr">as</span>=<span class="string">&quot;script&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;font.woff2&quot;</span> <span class="attr">as</span>=<span class="string">&quot;font&quot;</span> <span class="attr">type</span>=<span class="string">&quot;font/woff2&quot;</span> <span class="attr">crossorigin</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="3-CSSä¼˜åŒ–"><a href="#3-CSSä¼˜åŒ–" class="headerlink" title="3. CSSä¼˜åŒ–"></a>3. CSSä¼˜åŒ–</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å…³é”®CSSå†…è” --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">  <span class="comment">/* é¦–å±å…³é”®æ ·å¼ */</span></span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.header</span> &#123; ... &#125;</span></span><br><span class="line"><span class="language-css">  <span class="selector-class">.hero</span> &#123; ... &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- éå…³é”®CSSå¼‚æ­¥åŠ è½½ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;this.onload=null;this.rel=&#x27;stylesheet&#x27;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">noscript</span>&gt;</span><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ğŸ“¦-ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½"><a href="#ğŸ“¦-ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½" class="headerlink" title="ğŸ“¦ ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½"></a>ğŸ“¦ ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½</h2><h3 id="Webpackä»£ç åˆ†å‰²"><a href="#Webpackä»£ç åˆ†å‰²" class="headerlink" title="Webpackä»£ç åˆ†å‰²"></a>Webpackä»£ç åˆ†å‰²</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">vendors</span>: &#123;</span><br><span class="line">          <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">          <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">common</span>: &#123;</span><br><span class="line">          <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">          <span class="attr">name</span>: <span class="string">&#x27;common&#x27;</span>,</span><br><span class="line">          <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="Reactæ‡’åŠ è½½"><a href="#Reactæ‡’åŠ è½½" class="headerlink" title="Reactæ‡’åŠ è½½"></a>Reactæ‡’åŠ è½½</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; <span class="title class_">Suspense</span>, lazy &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¯ç”±æ‡’åŠ è½½</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Home</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/Home&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">About</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/About&#x27;</span>));</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Dashboard</span> = <span class="title function_">lazy</span>(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./pages/Dashboard&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">Suspense</span> <span class="attr">fallback</span>=<span class="string">&#123;</span>&lt;<span class="attr">Loading</span> /&gt;</span>&#125;&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Home</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/about&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">About</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/dashboard&quot;</span> <span class="attr">element</span>=<span class="string">&#123;</span>&lt;<span class="attr">Dashboard</span> /&gt;</span>&#125; /&gt;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">Routes</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Vueæ‡’åŠ è½½"><a href="#Vueæ‡’åŠ è½½" class="headerlink" title="Vueæ‡’åŠ è½½"></a>Vueæ‡’åŠ è½½</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue Router</span></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&#x27;/dashboard&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &quot;dashboard&quot; */</span> <span class="string">&#x27;./views/Dashboard.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»„ä»¶æ‡’åŠ è½½</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">HeavyComponent</span>: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;./HeavyComponent.vue&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ğŸ—œï¸-èµ„æºå‹ç¼©"><a href="#ğŸ—œï¸-èµ„æºå‹ç¼©" class="headerlink" title="ğŸ—œï¸ èµ„æºå‹ç¼©"></a>ğŸ—œï¸ èµ„æºå‹ç¼©</h2><h3 id="Gzip-Brotliå‹ç¼©"><a href="#Gzip-Brotliå‹ç¼©" class="headerlink" title="Gzip&#x2F;Brotliå‹ç¼©"></a>Gzip&#x2F;Brotliå‹ç¼©</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginxé…ç½®</span></span><br><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_types</span> text/plain text/css application/json application/javascript text/xml;</span><br><span class="line"><span class="attribute">gzip_min_length</span> <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Brotliå‹ç¼©ï¼ˆæ›´é«˜å‹ç¼©ç‡ï¼‰</span></span><br><span class="line"><span class="attribute">brotli</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">brotli_types</span> text/plain text/css application/json application/javascript;</span><br></pre></td></tr></table></figure><h3 id="å›¾ç‰‡å‹ç¼©é…ç½®"><a href="#å›¾ç‰‡å‹ç¼©é…ç½®" class="headerlink" title="å›¾ç‰‡å‹ç¼©é…ç½®"></a>å›¾ç‰‡å‹ç¼©é…ç½®</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpacké…ç½®</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">ImageMinimizerPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;image-minimizer-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ImageMinimizerPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">minimizer</span>: &#123;</span><br><span class="line">        <span class="attr">implementation</span>: <span class="title class_">ImageMinimizerPlugin</span>.<span class="property">imageminMinify</span>,</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">plugins</span>: [</span><br><span class="line">            [<span class="string">&#x27;mozjpeg&#x27;</span>, &#123; <span class="attr">quality</span>: <span class="number">80</span> &#125;],</span><br><span class="line">            [<span class="string">&#x27;pngquant&#x27;</span>, &#123; <span class="attr">quality</span>: [<span class="number">0.6</span>, <span class="number">0.8</span>] &#125;],</span><br><span class="line">            [<span class="string">&#x27;svgo&#x27;</span>, &#123; <span class="attr">plugins</span>: [&#123; <span class="attr">removeViewBox</span>: <span class="literal">false</span> &#125;] &#125;],</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ğŸ’¾-ç¼“å­˜ç­–ç•¥"><a href="#ğŸ’¾-ç¼“å­˜ç­–ç•¥" class="headerlink" title="ğŸ’¾ ç¼“å­˜ç­–ç•¥"></a>ğŸ’¾ ç¼“å­˜ç­–ç•¥</h2><h3 id="HTTPç¼“å­˜"><a href="#HTTPç¼“å­˜" class="headerlink" title="HTTPç¼“å­˜"></a>HTTPç¼“å­˜</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nginxç¼“å­˜é…ç½®</span></span><br><span class="line"><span class="section">location</span> <span class="regexp">~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff2)$</span> &#123;</span><br><span class="line">    <span class="attribute">expires</span> <span class="number">1y</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;public, immutable&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">location</span> <span class="regexp">~* \.html$</span> &#123;</span><br><span class="line">    <span class="attribute">expires</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="attribute">add_header</span> Cache-Control <span class="string">&quot;no-cache, no-store, must-revalidate&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Service-Workerç¼“å­˜"><a href="#Service-Workerç¼“å­˜" class="headerlink" title="Service Workerç¼“å­˜"></a>Service Workerç¼“å­˜</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sw.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CACHE_NAME</span> = <span class="string">&#x27;v1&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> urlsToCache = [</span><br><span class="line">  <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/styles/main.css&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;/scripts/main.js&#x27;</span>,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®‰è£…</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;install&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">waitUntil</span>(</span><br><span class="line">    caches.<span class="title function_">open</span>(<span class="variable constant_">CACHE_NAME</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">cache</span> =&gt;</span> cache.<span class="title function_">addAll</span>(urlsToCache))</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚æ‹¦æˆª</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;fetch&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  event.<span class="title function_">respondWith</span>(</span><br><span class="line">    caches.<span class="title function_">match</span>(event.<span class="property">request</span>)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (response) &#123;</span><br><span class="line">          <span class="keyword">return</span> response; <span class="comment">// è¿”å›ç¼“å­˜</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">fetch</span>(event.<span class="property">request</span>); <span class="comment">// è¯·æ±‚ç½‘ç»œ</span></span><br><span class="line">      &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ğŸ¨-æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–"><a href="#ğŸ¨-æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="ğŸ¨ æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–"></a>ğŸ¨ æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–</h2><h3 id="é¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€"><a href="#é¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€" class="headerlink" title="é¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€"></a>é¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// âŒ å¼ºåˆ¶åŒæ­¥å¸ƒå±€</span></span><br><span class="line">elements.<span class="title function_">forEach</span>(<span class="function"><span class="params">el</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> width = el.<span class="property">offsetWidth</span>; <span class="comment">// è¯»å–</span></span><br><span class="line">  el.<span class="property">style</span>.<span class="property">width</span> = width + <span class="number">10</span> + <span class="string">&#x27;px&#x27;</span>; <span class="comment">// å†™å…¥ -&gt; è§¦å‘é‡æ’</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âœ… æ‰¹é‡è¯»å–åæ‰¹é‡å†™å…¥</span></span><br><span class="line"><span class="keyword">const</span> widths = elements.<span class="title function_">map</span>(<span class="function"><span class="params">el</span> =&gt;</span> el.<span class="property">offsetWidth</span>); <span class="comment">// æ‰¹é‡è¯»å–</span></span><br><span class="line">elements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el, i</span>) =&gt;</span> &#123;</span><br><span class="line">  el.<span class="property">style</span>.<span class="property">width</span> = widths[i] + <span class="number">10</span> + <span class="string">&#x27;px&#x27;</span>; <span class="comment">// æ‰¹é‡å†™å…¥</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨CSSåŠ¨ç”»ä»£æ›¿JS"><a href="#ä½¿ç”¨CSSåŠ¨ç”»ä»£æ›¿JS" class="headerlink" title="ä½¿ç”¨CSSåŠ¨ç”»ä»£æ›¿JS"></a>ä½¿ç”¨CSSåŠ¨ç”»ä»£æ›¿JS</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* âœ… ä½¿ç”¨CSS transformåŠ¨ç”» */</span></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">transition</span>: transform <span class="number">0.3s</span> ease;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">100px</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* âœ… ä½¿ç”¨will-changeæç¤ºæµè§ˆå™¨ */</span></span><br><span class="line"><span class="selector-class">.animated-element</span> &#123;</span><br><span class="line">  <span class="attribute">will-change</span>: transform, opacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è™šæ‹Ÿåˆ—è¡¨"><a href="#è™šæ‹Ÿåˆ—è¡¨" class="headerlink" title="è™šæ‹Ÿåˆ—è¡¨"></a>è™šæ‹Ÿåˆ—è¡¨</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Reactè™šæ‹Ÿåˆ—è¡¨ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FixedSizeList</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;react-window&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">VirtualList</span>(<span class="params">&#123; items &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">Row</span> = (<span class="params">&#123; index, style &#125;</span>) =&gt; (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;style&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;items[index].name&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">FixedSizeList</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">height</span>=<span class="string">&#123;400&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">itemCount</span>=<span class="string">&#123;items.length&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">itemSize</span>=<span class="string">&#123;50&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">    &gt;</span></span></span><br><span class="line"><span class="language-xml">      &#123;Row&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">FixedSizeList</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ“±-ç§»åŠ¨ç«¯ä¼˜åŒ–"><a href="#ğŸ“±-ç§»åŠ¨ç«¯ä¼˜åŒ–" class="headerlink" title="ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–"></a>ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–</h2><h3 id="è§¦æ‘¸å“åº”ä¼˜åŒ–"><a href="#è§¦æ‘¸å“åº”ä¼˜åŒ–" class="headerlink" title="è§¦æ‘¸å“åº”ä¼˜åŒ–"></a>è§¦æ‘¸å“åº”ä¼˜åŒ–</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç¦ç”¨ç‚¹å‡»å»¶è¿Ÿ */</span></span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">touch-action</span>: manipulation;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä¼˜åŒ–æ»šåŠ¨ */</span></span><br><span class="line"><span class="selector-class">.scroll-container</span> &#123;</span><br><span class="line">  -webkit-<span class="attribute">overflow</span>-scrolling: touch;</span><br><span class="line">  <span class="attribute">overflow-y</span>: scroll;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éª¨æ¶å±"><a href="#éª¨æ¶å±" class="headerlink" title="éª¨æ¶å±"></a>éª¨æ¶å±</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">SkeletonCard</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;skeleton-card&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;skeleton-image animate-pulse&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;skeleton-title animate-pulse&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;skeleton-text animate-pulse&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">ProductList</span>(<span class="params">&#123; loading, products &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (loading) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>(<span class="number">6</span>).<span class="title function_">fill</span>(<span class="number">0</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">_, i</span>) =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">SkeletonCard</span> <span class="attr">key</span>=<span class="string">&#123;i&#125;</span> /&gt;</span></span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> products.<span class="title function_">map</span>(<span class="function"><span class="params">p</span> =&gt;</span> <span class="language-xml"><span class="tag">&lt;<span class="name">ProductCard</span> <span class="attr">key</span>=<span class="string">&#123;p.id&#125;</span> <span class="attr">product</span>=<span class="string">&#123;p&#125;</span> /&gt;</span></span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ“ˆ-æ€§èƒ½ç›‘æ§"><a href="#ğŸ“ˆ-æ€§èƒ½ç›‘æ§" class="headerlink" title="ğŸ“ˆ æ€§èƒ½ç›‘æ§"></a>ğŸ“ˆ æ€§èƒ½ç›‘æ§</h2><h3 id="Performance-API"><a href="#Performance-API" class="headerlink" title="Performance API"></a>Performance API</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¡µé¢åŠ è½½æ€§èƒ½</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timing = performance.<span class="property">timing</span>;</span><br><span class="line">  <span class="keyword">const</span> metrics = &#123;</span><br><span class="line">    <span class="comment">// DNSæŸ¥è¯¢æ—¶é—´</span></span><br><span class="line">    <span class="attr">dns</span>: timing.<span class="property">domainLookupEnd</span> - timing.<span class="property">domainLookupStart</span>,</span><br><span class="line">    <span class="comment">// TCPè¿æ¥æ—¶é—´</span></span><br><span class="line">    <span class="attr">tcp</span>: timing.<span class="property">connectEnd</span> - timing.<span class="property">connectStart</span>,</span><br><span class="line">    <span class="comment">// é¦–å­—èŠ‚æ—¶é—´</span></span><br><span class="line">    <span class="attr">ttfb</span>: timing.<span class="property">responseStart</span> - timing.<span class="property">requestStart</span>,</span><br><span class="line">    <span class="comment">// DOMè§£ææ—¶é—´</span></span><br><span class="line">    <span class="attr">domParse</span>: timing.<span class="property">domContentLoadedEventEnd</span> - timing.<span class="property">domLoading</span>,</span><br><span class="line">    <span class="comment">// é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´</span></span><br><span class="line">    <span class="attr">loadTime</span>: timing.<span class="property">loadEventEnd</span> - timing.<span class="property">navigationStart</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(metrics);</span><br><span class="line">  <span class="comment">// ä¸ŠæŠ¥åˆ°ç›‘æ§ç³»ç»Ÿ</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘æ§LCP</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">entryList</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = entryList.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">const</span> lastEntry = entries[entries.<span class="property">length</span> - <span class="number">1</span>];</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;LCP:&#x27;</span>, lastEntry.<span class="property">startTime</span>);</span><br><span class="line">&#125;).<span class="title function_">observe</span>(&#123; <span class="attr">entryTypes</span>: [<span class="string">&#x27;largest-contentful-paint&#x27;</span>] &#125;);</span><br></pre></td></tr></table></figure><h3 id="Web-Vitalsç›‘æ§"><a href="#Web-Vitalsç›‘æ§" class="headerlink" title="Web Vitalsç›‘æ§"></a>Web Vitalsç›‘æ§</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; getCLS, getFID, getLCP &#125; <span class="keyword">from</span> <span class="string">&#x27;web-vitals&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sendToAnalytics</span>(<span class="params">metric</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> body = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(metric);</span><br><span class="line">  navigator.<span class="title function_">sendBeacon</span>(<span class="string">&#x27;/analytics&#x27;</span>, body);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">getCLS</span>(sendToAnalytics);</span><br><span class="line"><span class="title function_">getFID</span>(sendToAnalytics);</span><br><span class="line"><span class="title function_">getLCP</span>(sendToAnalytics);</span><br></pre></td></tr></table></figure><h2 id="âœ…-æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•"><a href="#âœ…-æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•" class="headerlink" title="âœ… æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•"></a>âœ… æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥æ¸…å•</h2><h3 id="åŠ è½½ä¼˜åŒ–"><a href="#åŠ è½½ä¼˜åŒ–" class="headerlink" title="åŠ è½½ä¼˜åŒ–"></a>åŠ è½½ä¼˜åŒ–</h3><ul><li><input disabled="" type="checkbox"> å¼€å¯Gzip&#x2F;Brotliå‹ç¼©</li><li><input disabled="" type="checkbox"> å›¾ç‰‡ä½¿ç”¨WebPæ ¼å¼</li><li><input disabled="" type="checkbox"> å®ç°å›¾ç‰‡æ‡’åŠ è½½</li><li><input disabled="" type="checkbox"> ä»£ç åˆ†å‰²å’ŒæŒ‰éœ€åŠ è½½</li><li><input disabled="" type="checkbox"> ä½¿ç”¨CDNåŠ é€Ÿ</li></ul><h3 id="ç¼“å­˜ä¼˜åŒ–"><a href="#ç¼“å­˜ä¼˜åŒ–" class="headerlink" title="ç¼“å­˜ä¼˜åŒ–"></a>ç¼“å­˜ä¼˜åŒ–</h3><ul><li><input disabled="" type="checkbox"> é…ç½®åˆç†çš„HTTPç¼“å­˜</li><li><input disabled="" type="checkbox"> ä½¿ç”¨Service Worker</li><li><input disabled="" type="checkbox"> é™æ€èµ„æºæ·»åŠ hash</li></ul><h3 id="æ¸²æŸ“ä¼˜åŒ–"><a href="#æ¸²æŸ“ä¼˜åŒ–" class="headerlink" title="æ¸²æŸ“ä¼˜åŒ–"></a>æ¸²æŸ“ä¼˜åŒ–</h3><ul><li><input disabled="" type="checkbox"> å‡å°‘DOMæ“ä½œ</li><li><input disabled="" type="checkbox"> ä½¿ç”¨CSSåŠ¨ç”»</li><li><input disabled="" type="checkbox"> é•¿åˆ—è¡¨è™šæ‹ŸåŒ–</li><li><input disabled="" type="checkbox"> é¿å…å¼ºåˆ¶åŒæ­¥å¸ƒå±€</li></ul><h3 id="ä»£ç ä¼˜åŒ–"><a href="#ä»£ç ä¼˜åŒ–" class="headerlink" title="ä»£ç ä¼˜åŒ–"></a>ä»£ç ä¼˜åŒ–</h3><ul><li><input disabled="" type="checkbox"> Tree Shaking</li><li><input disabled="" type="checkbox"> ä»£ç å‹ç¼©æ··æ·†</li><li><input disabled="" type="checkbox"> ç§»é™¤æœªä½¿ç”¨ä»£ç </li></ul><hr><p><strong>æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬ä¸€èµ·è¿½æ±‚æè‡´ä½“éªŒï¼</strong> ğŸš€</p>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯å¼€å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> JavaScript </tag>
            
            <tag> Webpack </tag>
            
            <tag> ç”¨æˆ·ä½“éªŒ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springæ¡†æ¶ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šä»XMLåˆ°æ³¨è§£çš„æ¼”è¿›ä¹‹è·¯</title>
      <link href="/2025/05/28/sping%E6%A1%86%E6%9E%B6xml%E5%92%8C%E6%B3%A8%E8%A7%A3%E6%B3%A8%E5%85%A5%E7%9A%84%E7%90%86%E8%A7%A3/"/>
      <url>/2025/05/28/sping%E6%A1%86%E6%9E%B6xml%E5%92%8C%E6%B3%A8%E8%A7%A3%E6%B3%A8%E5%85%A5%E7%9A%84%E7%90%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="Springæ¡†æ¶ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šä»XMLåˆ°æ³¨è§£çš„æ¼”è¿›ä¹‹è·¯"><a href="#Springæ¡†æ¶ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šä»XMLåˆ°æ³¨è§£çš„æ¼”è¿›ä¹‹è·¯" class="headerlink" title="Springæ¡†æ¶ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šä»XMLåˆ°æ³¨è§£çš„æ¼”è¿›ä¹‹è·¯"></a>Springæ¡†æ¶ä¾èµ–æ³¨å…¥æ·±åº¦è§£æï¼šä»XMLåˆ°æ³¨è§£çš„æ¼”è¿›ä¹‹è·¯</h1><blockquote><p>ğŸŒŸ <strong>æ ¸å¿ƒè¦ç‚¹é¢„è§ˆ</strong></p><ul><li>ç†è§£IoCå®¹å™¨çš„æœ¬è´¨å’Œä½œç”¨</li><li>æŒæ¡ä¾èµ–æ³¨å…¥çš„ä¸‰ç§å®ç°æ–¹å¼</li><li>å¯¹æ¯”XMLé…ç½®ä¸æ³¨è§£é…ç½®çš„ä¼˜åŠ£</li><li>å­¦ä¹ Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†</li><li>æ¢ç´¢ç°ä»£Springå¼€å‘æœ€ä½³å®è·µ</li></ul></blockquote><h2 id="ğŸ¯-ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ"><a href="#ğŸ¯-ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ" class="headerlink" title="ğŸ¯ ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ"></a>ğŸ¯ ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</h2><p>åœ¨è®¨è®ºæ³¨è§£ï¼Œxmlä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå›å½’springæœ€æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„æ¦‚å¿µâ€”â€”å®¹å™¨ã€‚å®¹å™¨ï¼Œé¡¾åæ€ä¹‰ï¼Œä¸ºæŸç§ç‰¹å®šç»„ä»¶çš„è¿è¡Œæä¾›å¿…è¦æ”¯æŒçš„ä¸€ä¸ªè½¯ä»¶ç¯å¢ƒã€‚åœ¨javaå¼€å‘ä¸­ï¼Œç»„ä»¶çš„è€¦åˆä¾èµ–æ˜¯å¸¸æœ‰ä¹‹äº‹ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‚è€ƒå»–é›ªå³°è€å¸ˆçš„æ•™ç¨‹ï¼ˆçŸ¥ä¹å·ï¼š<a href="https://www.zhihu.com/people/liaoxuefeng">(å»–é›ªå³° - çŸ¥ä¹</a>ï¼‰</p><p>æˆ‘ä»¬å‡å®šä¸€ä¸ªåœ¨çº¿ä¹¦åº—ï¼Œé€šè¿‡<code>BookService</code>è·å–ä¹¦ç±ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">HikariConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariConfig</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBook</span><span class="params">(<span class="type">long</span> bookId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> book;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®ä¾‹åŒ–ä¸€ä¸ªHikariDataSourceï¼Œæˆ‘ä»¬ä¸å¾—ä¸å®ä¾‹åŒ–ä¸€ä¸ªHikariConfigã€‚è€Œè¦å®ä¾‹åŒ–è¿™ä¸ªHikariConfigï¼Œæˆ‘ä»¬å¿…é¡»è¦ç†ŸçŸ¥å®ƒçš„é…ç½®</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­ç¼–å†™<code>UserService</code>è·å–ç”¨æˆ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">HikariConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariConfig</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="type">long</span> userId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>UserService</code>ä¹Ÿéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¹Ÿå®ä¾‹åŒ–ä¸€ä¸ª<code>HikariDataSource</code>ã€‚</p><p>åœ¨å¤„ç†ç”¨æˆ·è´­ä¹°çš„<code>CartServlet</code>ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–<code>UserService</code>å’Œ<code>BookService</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookService</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">currentUserId</span> <span class="operator">=</span> getFromCookie(req);</span><br><span class="line">        <span class="type">User</span> <span class="variable">currentUser</span> <span class="operator">=</span> userService.getUser(currentUserId);</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getBook(req.getParameter(<span class="string">&quot;bookId&quot;</span>));</span><br><span class="line">        cartService.addToCart(currentUser, book);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šè¿°ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ— è®ºæ˜¯BookServiceè¿˜æ˜¯UserServiceï¼Œéƒ½é€šè¿‡newä¸€ä¸ªå®ä¾‹æ¥åˆ›å»ºHikariCofigï¼Œè¿™æ˜¾ç„¶é€ æˆäº†å†—ä½™å’Œèµ„æºçš„æµªè´¹ï¼Œä»–ä»¬æ˜æ˜å¯ä»¥å…±äº«ä¸€ä¸ªHikariConfig,æ›´å‡†ç¡®çš„è¯´æ˜¯ç”±è¿™ä¸ªé…ç½®åˆ›å»ºçš„datasourceã€‚ä½†è°æ¥è´Ÿè´£åˆ›å»ºè¿™ä¸ªç»„ä»¶ï¼Œè°åˆæ¥è´Ÿè´£ç®¡ç†å’Œé”€æ¯è¿™ä¸ªç»„ä»¶ï¼Œä»¥å¤„ç†å®ƒæ‰€å¸¦æ¥çš„ä¸€ç³»åˆ—çš„ä¾èµ–å’Œè€¦åˆå‘¢ï¼Œå¦‚æœè¯¥ç»„ä»¶è¢«å¤šä¸ªç»„ä»¶å…±äº«ï¼Œå¦‚ä½•ç¡®ä¿å®ƒçš„ä½¿ç”¨æ–¹éƒ½å·²ç»å…¨éƒ¨è¢«é”€æ¯ï¼Ÿæµ‹è¯•æŸä¸ªç»„ä»¶ï¼Œä¾‹å¦‚<code>BookService</code>ï¼Œæ˜¯å¤æ‚çš„ï¼Œå› ä¸ºå¿…é¡»è¦åœ¨çœŸå®çš„æ•°æ®åº“ç¯å¢ƒä¸‹æ‰§è¡Œã€‚è¿™ä¸€ç³»åˆ—é—®é¢˜ï¼Œéƒ½å¯¼è‡´äº†è¿™ä¸ªå®¹å™¨å‡ºç°çš„å¿…ç„¶ã€‚è€Œåœ¨springæ¡†æ¶ä¸­ï¼Œè¿™ä¸ªå®¹å™¨è¢«å‘½åä¸º<strong>IOC</strong>ï¼Œç›´è¯‘ä¸ºæ§åˆ¶åè½¬ã€‚</p><h1 id="IOCçš„åŸç†"><a href="#IOCçš„åŸç†" class="headerlink" title="IOCçš„åŸç†"></a>IOCçš„åŸç†</h1><p>ä¼ ç»Ÿçš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ§åˆ¶æƒåœ¨ç¨‹åºæœ¬èº«ï¼Œç¨‹åºçš„æ§åˆ¶æµç¨‹å®Œå…¨ç”±å¼€å‘è€…æ§åˆ¶ï¼Œä¾‹å¦‚ï¼š</p><p><code>CartServlet</code>åˆ›å»ºäº†<code>BookService</code>ï¼Œåœ¨åˆ›å»º<code>BookService</code>çš„è¿‡ç¨‹ä¸­ï¼Œåˆåˆ›å»ºäº†<code>DataSource</code>ç»„ä»¶ã€‚è¿™ç§æ¨¡å¼çš„ç¼ºç‚¹æ˜¯ï¼Œä¸€ä¸ªç»„ä»¶å¦‚æœè¦ä½¿ç”¨å¦ä¸€ä¸ªç»„ä»¶ï¼Œå¿…é¡»å…ˆçŸ¥é“å¦‚ä½•æ­£ç¡®åœ°åˆ›å»ºå®ƒã€‚</p><p>åœ¨IoCæ¨¡å¼ä¸‹ï¼Œæ§åˆ¶æƒå‘ç”Ÿäº†åè½¬ï¼Œå³ä»åº”ç”¨ç¨‹åºè½¬ç§»åˆ°äº†IoCå®¹å™¨ï¼Œæ‰€æœ‰ç»„ä»¶ä¸å†ç”±åº”ç”¨ç¨‹åºè‡ªå·±åˆ›å»ºå’Œé…ç½®ï¼Œè€Œæ˜¯ç”±IoCå®¹å™¨è´Ÿè´£ï¼Œè¿™æ ·ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ç›´æ¥ä½¿ç”¨å·²ç»åˆ›å»ºå¥½å¹¶ä¸”é…ç½®å¥½çš„ç»„ä»¶ã€‚ä¸ºäº†èƒ½è®©ç»„ä»¶åœ¨IoCå®¹å™¨ä¸­è¢«â€œè£…é…â€å‡ºæ¥ï¼Œéœ€è¦æŸç§â€œæ³¨å…¥â€æœºåˆ¶ï¼Œä¾‹å¦‚ï¼Œ<code>BookService</code>è‡ªå·±å¹¶ä¸ä¼šåˆ›å»º<code>DataSource</code>ï¼Œè€Œæ˜¯ç­‰å¾…å¤–éƒ¨é€šè¿‡<code>setDataSource()</code>æ–¹æ³•æ¥æ³¨å…¥ä¸€ä¸ª<code>DataSource</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDataSource</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ç›´æ¥<code>new</code>ä¸€ä¸ª<code>DataSource</code>ï¼Œè€Œæ˜¯æ³¨å…¥ä¸€ä¸ª<code>DataSource</code>ï¼Œè¿™ä¸ªå°å°çš„æ”¹åŠ¨è™½ç„¶ç®€å•ï¼Œå´å¸¦æ¥äº†ä¸€ç³»åˆ—å¥½å¤„ï¼š</p><ol><li><code>BookService</code>ä¸å†å…³å¿ƒå¦‚ä½•åˆ›å»º<code>DataSource</code>ï¼Œå› æ­¤ï¼Œä¸å¿…ç¼–å†™è¯»å–æ•°æ®åº“é…ç½®ä¹‹ç±»çš„ä»£ç ï¼›</li><li><code>DataSource</code>å®ä¾‹è¢«æ³¨å…¥åˆ°<code>BookService</code>ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ³¨å…¥åˆ°<code>UserService</code>ï¼Œå› æ­¤ï¼Œå…±äº«ä¸€ä¸ªç»„ä»¶éå¸¸ç®€å•ï¼›</li><li>æµ‹è¯•<code>BookService</code>æ›´å®¹æ˜“ï¼Œå› ä¸ºæ³¨å…¥çš„æ˜¯<code>DataSource</code>ï¼Œå¯ä»¥ä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼Œè€Œä¸æ˜¯çœŸå®çš„MySQLé…ç½®ã€‚</li></ol><p>å› æ­¤ï¼ŒIoCåˆç§°ä¸º<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆDIï¼šDependency Injectionï¼‰ï¼Œå®ƒè§£å†³äº†ä¸€ä¸ªæœ€ä¸»è¦çš„é—®é¢˜ï¼šå°†ç»„ä»¶çš„åˆ›å»º+é…ç½®ä¸ç»„ä»¶çš„ä½¿ç”¨ç›¸åˆ†ç¦»ï¼Œå¹¶ä¸”ï¼Œç”±IoCå®¹å™¨è´Ÿè´£ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p><u>åœ¨iocé‡Œå®¹å™¨é‡Œï¼Œæ‰€æœ‰çš„ç»„ä»¶éƒ½è¢«å«åšJavabean,å³é…ç½®ä¸€ä¸ªç»„ä»¶å°±æ˜¯é…ç½®ä¸€ä¸ªBeanã€‚</u>è¿™å¥è¯è®©æˆ‘å—ç›ŠåŒªæµ…ã€‚</p><h2 id="Xmlé…ç½®"><a href="#Xmlé…ç½®" class="headerlink" title="Xmlé…ç½®"></a>Xmlé…ç½®</h2><p>åœ¨springæ¡†æ¶é‡Œï¼Œæœ‰è‡ªå¸¦çš„application.xmlæ–‡ä»¶ã€‚åœ¨é‡Œé¢ï¼Œä½ å¯ä»¥è‡ªå·±ç®¡ç†æ‰€æœ‰çš„beanã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itranswarp.learnjava.service.UserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mailService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;mailService&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mailService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itranswarp.learnjava.service.MailService&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>beanå¯¹è±¡é€šè¿‡<bean>ç®¡ç†å’Œæ ‡è¯†ï¼Œ<property name=""  ref="">æ¥æ³¨å…¥åˆ«çš„beanå¯¹è±¡</p><h2 id="æ³¨è§£é…ç½®"><a href="#æ³¨è§£é…ç½®" class="headerlink" title="æ³¨è§£é…ç½®"></a>æ³¨è§£é…ç½®</h2><p>åƒä¸Šé¢çš„xmlé…ç½®ï¼Œç¼ºç‚¹å¼Šç«¯ä¸€ç›®äº†ç„¶ï¼Œä¸€æƒ³ä¾¿çŸ¥ï¼Œæ¯æ„é€ ä¸€ä¸ªbeanå¯¹è±¡ï¼Œæˆ‘ä»¬å°±è¦åœ¨xmlé‡Œé…ç½®æ³¨å…¥iocå®¹å™¨ï¼Œç»„ä»¶å’Œç»„ä»¶ä¹‹é—´çš„ä¾èµ–å†™èµ·æ¥ä¹Ÿååˆ†éº»çƒ¦ï¼Œå®¹æ˜“é—å¿˜ï¼Œä¸ä¾¿äºç»´æŠ¤ã€‚</p><p><strong>äºæ˜¯</strong></p><p>springå¼•å‡ºäº†æ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>@Component</code>æ³¨è§£å°±ç›¸å½“äºå®šä¹‰äº†ä¸€ä¸ªBeanï¼Œå®ƒæœ‰ä¸€ä¸ªå¯é€‰çš„åç§°ï¼Œé»˜è®¤æ˜¯<code>mailService</code>ï¼Œå³å°å†™å¼€å¤´çš„ç±»åã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬ç»™<code>UserService</code>æ·»åŠ ä¸€ä¸ª<code>@Component</code>æ³¨è§£å’Œä¸€ä¸ª<code>@Autowired</code>æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MailService mailService;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>@Autowired</code>å°±ç›¸å½“äºæŠŠæŒ‡å®šç±»å‹çš„Beanæ³¨å…¥åˆ°æŒ‡å®šçš„å­—æ®µä¸­ã€‚å’ŒXMLé…ç½®ç›¸æ¯”ï¼Œ<code>@Autowired</code>å¤§å¹…ç®€åŒ–äº†æ³¨å…¥ï¼Œå› ä¸ºå®ƒä¸ä½†å¯ä»¥å†™åœ¨<code>set()</code>æ–¹æ³•ä¸Šï¼Œè¿˜å¯ä»¥ç›´æ¥å†™åœ¨å­—æ®µä¸Šï¼Œç”šè‡³å¯ä»¥å†™åœ¨æ„é€ æ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    MailService mailService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(<span class="meta">@Autowired</span> MailService mailService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mailService = mailService;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸€èˆ¬æŠŠ<code>@Autowired</code>å†™åœ¨å­—æ®µä¸Šï¼Œé€šå¸¸ä½¿ç”¨packageæƒé™çš„å­—æ®µï¼Œä¾¿äºæµ‹è¯•ã€‚</p><p>æœ€åï¼Œç¼–å†™ä¸€ä¸ª<code>AppConfig</code>ç±»å¯åŠ¨å®¹å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.login(<span class="string">&quot;bob@example.com&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line">        System.out.println(user.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†<code>main()</code>æ–¹æ³•å¤–ï¼Œ<code>AppConfig</code>æ ‡æ³¨äº†<code>@Configuration</code>ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå› ä¸ºæˆ‘ä»¬åˆ›å»º<code>ApplicationContext</code>æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„å®ç°ç±»æ˜¯<code>AnnotationConfigApplicationContext</code>ï¼Œå¿…é¡»ä¼ å…¥ä¸€ä¸ªæ ‡æ³¨äº†<code>@Configuration</code>çš„ç±»åã€‚</p><p>æ­¤å¤–ï¼Œ<code>AppConfig</code>è¿˜æ ‡æ³¨äº†<code>@ComponentScan</code>ï¼Œå®ƒå‘Šè¯‰å®¹å™¨ï¼Œè‡ªåŠ¨æœç´¢å½“å‰ç±»æ‰€åœ¨çš„åŒ…ä»¥åŠå­åŒ…ï¼ŒæŠŠæ‰€æœ‰æ ‡æ³¨ä¸º<code>@Component</code>çš„Beanè‡ªåŠ¨åˆ›å»ºå‡ºæ¥ï¼Œå¹¶æ ¹æ®<code>@Autowired</code>è¿›è¡Œè£…é…ã€‚</p><p>ä½¿ç”¨Annotationé…åˆè‡ªåŠ¨æ‰«æèƒ½å¤§å¹…ç®€åŒ–Springçš„é…ç½®ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯ï¼š</p><ul><li>æ¯ä¸ªBeanè¢«æ ‡æ³¨ä¸º<code>@Component</code>å¹¶æ­£ç¡®ä½¿ç”¨<code>@Autowired</code>æ³¨å…¥ï¼›</li><li>é…ç½®ç±»è¢«æ ‡æ³¨ä¸º<code>@Configuration</code>å’Œ<code>@ComponentScan</code>ï¼›</li><li>æ‰€æœ‰Beanå‡åœ¨æŒ‡å®šåŒ…ä»¥åŠå­åŒ…å†…ã€‚</li></ul><p>ä½¿ç”¨<code>@ComponentScan</code>éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç‰¹åˆ«æ³¨æ„åŒ…çš„å±‚æ¬¡ç»“æ„ã€‚é€šå¸¸æ¥è¯´ï¼Œå¯åŠ¨é…ç½®<code>AppConfig</code>ä½äºè‡ªå®šä¹‰çš„é¡¶å±‚åŒ…ï¼ˆä¾‹å¦‚<code>com.itranswarp.learnjava</code>ï¼‰ï¼Œå…¶ä»–BeanæŒ‰ç±»åˆ«æ”¾å…¥å­åŒ…ã€‚</p><h6 id="ä¸Šè¿°ä¾‹å­ä¸ºcopyï¼Œæœ¬äºº-componentScanç†è§£ä¾æ‰˜ï¼Œå°±ä¸çŒ®ä¸‘äº†"><a href="#ä¸Šè¿°ä¾‹å­ä¸ºcopyï¼Œæœ¬äºº-componentScanç†è§£ä¾æ‰˜ï¼Œå°±ä¸çŒ®ä¸‘äº†" class="headerlink" title="ä¸Šè¿°ä¾‹å­ä¸ºcopyï¼Œæœ¬äºº@componentScanç†è§£ä¾æ‰˜ï¼Œå°±ä¸çŒ®ä¸‘äº†"></a>ä¸Šè¿°ä¾‹å­ä¸ºcopyï¼Œæœ¬äºº@componentScanç†è§£ä¾æ‰˜ï¼Œå°±ä¸çŒ®ä¸‘äº†</h6><blockquote><p>å‚è€ƒæ–‡çŒ®ï¼š<br>[Jdk17å®˜æ–¹æ–‡æ¡£]: <a href="https://doc.qzxdp.cn/jdk/17/zh/api/index.html">https://doc.qzxdp.cn/jdk/17/zh/api/index.html</a><br>[springå®˜æ–¹æ–‡æ¡£]: <a href="https://spring.io/docs">https://spring.io/docs</a><br>[å»–é›ªå³°javaæ–‡æ¡£]: <a href="https://liaoxuefeng.com/books/java/spring/ioc/annotation-config/index.html">https://liaoxuefeng.com/books/java/spring/ioc/annotation-config/index.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> JavaæŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> ä¾èµ–æ³¨å…¥ </tag>
            
            <tag> IoC </tag>
            
            <tag> æ¡†æ¶è®¾è®¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·¯ç”±çš„ç†è§£</title>
      <link href="/2025/05/28/%E8%B7%AF%E7%94%B1%E7%9A%84%E7%90%86%E8%A7%A3/"/>
      <url>/2025/05/28/%E8%B7%AF%E7%94%B1%E7%9A%84%E7%90%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªæ¸…å•ï¼Œä»å®è§‚åˆ°å¾®è§‚ï¼Œå‹¾å‹’å‡ºæˆ‘ä»¬å°†è¦æ¢ç´¢çš„çŸ¥è¯†ç‰ˆå›¾ï¼š</p><ul><li><input disabled="" type="checkbox"> <strong>ä¸€ã€è·¯ç”±çš„æ ¸å¿ƒæ€æƒ³ä¸ç°å®ç±»æ¯”</strong><ul><li><input disabled="" type="checkbox"> <strong>1.1 è·¯ç”±çš„æœ¬è´¨å®šä¹‰</strong><ul><li><input disabled="" type="checkbox"> ä»€ä¹ˆæ˜¯è·¯ç”±ï¼šå¯»æ‰¾è·¯å¾„çš„è¿‡ç¨‹</li><li><input disabled="" type="checkbox"> è·¯ç”±è§£å†³çš„æ ¸å¿ƒé—®é¢˜ï¼šä»Aåˆ°B</li><li><input disabled="" type="checkbox"> è·¯ç”±çš„ä¸‰å¤§è¦ç´ ï¼šç›®çš„åœ°ã€æ¥æºã€è·¯å¾„</li></ul></li><li><input disabled="" type="checkbox"> <strong>1.2 ç”Ÿæ´»ä¸­çš„è·¯ç”±æ¡ˆä¾‹</strong><ul><li><input disabled="" type="checkbox"> æ¡ˆä¾‹ä¸€ï¼šé—®è·¯ä¸å¯¼èˆª</li><li><input disabled="" type="checkbox"> æ¡ˆä¾‹äºŒï¼šé‚®æ”¿å¿«é€’ç³»ç»Ÿ</li><li><input disabled="" type="checkbox"> æ¡ˆä¾‹ä¸‰ï¼šèˆªç­ä¸­è½¬ç³»ç»Ÿ</li></ul></li><li><input disabled="" type="checkbox"> <strong>1.3 æŠ½è±¡å‡ºæ ¸å¿ƒæ¦‚å¿µ</strong><ul><li><input disabled="" type="checkbox"> èŠ‚ç‚¹ï¼ˆNodeï¼‰ä¸è·¯å¾„ï¼ˆPathï¼‰</li><li><input disabled="" type="checkbox"> ä¸‹ä¸€è·³ï¼ˆNext Hopï¼‰</li><li><input disabled="" type="checkbox"> è·¯ç”±è¡¨ï¼ˆRouting Tableï¼‰</li></ul></li></ul></li><li><input disabled="" type="checkbox"> <strong>äºŒã€è®¡ç®—æœºç½‘ç»œä¸­çš„è·¯ç”±</strong><ul><li><input disabled="" type="checkbox"> <strong>2.1 è·¯ç”±åœ¨ç½‘ç»œåˆ†å±‚æ¨¡å‹ä¸­çš„ä½ç½®</strong><ul><li><input disabled="" type="checkbox"> OSIä¸ƒå±‚æ¨¡å‹ä¸­çš„ç½‘ç»œå±‚</li><li><input disabled="" type="checkbox"> IPåœ°å€çš„è§’è‰²</li></ul></li><li><input disabled="" type="checkbox"> <strong>2.2 é™æ€è·¯ç”± vs. åŠ¨æ€è·¯ç”±</strong><ul><li><input disabled="" type="checkbox"> é™æ€è·¯ç”±ï¼šæ‰‹åŠ¨é…ç½®ï¼Œç®€å•å¯é¢„æµ‹</li><li><input disabled="" type="checkbox"> åŠ¨æ€è·¯ç”±ï¼šè‡ªåŠ¨å­¦ä¹ ï¼Œå¤æ‚è‡ªé€‚åº”</li></ul></li><li><input disabled="" type="checkbox"> <strong>2.3 å¸¸è§çš„åŠ¨æ€è·¯ç”±åè®®</strong><ul><li><input disabled="" type="checkbox"> å†…éƒ¨ç½‘å…³åè®®ï¼ˆIGPï¼‰ï¼šRIP, OSPF</li><li><input disabled="" type="checkbox"> å¤–éƒ¨ç½‘å…³åè®®ï¼ˆEGPï¼‰ï¼šBGP</li></ul></li></ul></li><li><input disabled="" type="checkbox"> <strong>ä¸‰ã€Webåº”ç”¨å¼€å‘ä¸­çš„è·¯ç”±</strong><ul><li><input disabled="" type="checkbox"> <strong>3.1 åç«¯è·¯ç”±</strong><ul><li><input disabled="" type="checkbox"> å®šä¹‰ï¼šURLåˆ°å¤„ç†å‡½æ•°çš„æ˜ å°„</li><li><input disabled="" type="checkbox"> æ¡ˆä¾‹ï¼šExpress.js &#x2F; Spring MVC</li><li><input disabled="" type="checkbox"> RESTful APIè®¾è®¡ç†å¿µ</li></ul></li><li><input disabled="" type="checkbox"> <strong>3.2 å‰ç«¯è·¯ç”±</strong><ul><li><input disabled="" type="checkbox"> å®šä¹‰ï¼šåœ¨å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰ä¸­ç®¡ç†è§†å›¾åˆ‡æ¢</li><li><input disabled="" type="checkbox"> å®ç°æ¨¡å¼ï¼šHashæ¨¡å¼ vs. Historyæ¨¡å¼</li><li><input disabled="" type="checkbox"> æ¡ˆä¾‹ï¼šReact Router &#x2F; Vue Router</li></ul></li><li><input disabled="" type="checkbox"> <strong>3.3 å‰åç«¯è·¯ç”±çš„åä½œä¸åŒºåˆ«</strong><ul><li><input disabled="" type="checkbox"> åä½œæ¨¡å¼</li><li><input disabled="" type="checkbox"> æ ¸å¿ƒåŒºåˆ«</li></ul></li></ul></li><li><input disabled="" type="checkbox"> <strong>å››ã€è·¯ç”±çš„æŒ‘æˆ˜ä¸æœªæ¥</strong><ul><li><input disabled="" type="checkbox"> <strong>4.1 è·¯ç”±ç®—æ³•çš„æ ¸å¿ƒ</strong><ul><li><input disabled="" type="checkbox"> è·ç¦»çŸ¢é‡ç®—æ³•</li><li><input disabled="" type="checkbox"> é“¾è·¯çŠ¶æ€ç®—æ³•</li></ul></li><li><input disabled="" type="checkbox"> <strong>4.2 è·¯ç”±é¢ä¸´çš„æŒ‘æˆ˜</strong><ul><li><input disabled="" type="checkbox"> è·¯ç”±å®‰å…¨</li><li><input disabled="" type="checkbox"> ç­–ç•¥è·¯ç”±ä¸QoS</li><li><input disabled="" type="checkbox"> å¯æ‰©å±•æ€§</li></ul></li><li><input disabled="" type="checkbox"> <strong>4.3 æœªæ¥çš„è·¯ç”±æŠ€æœ¯</strong><ul><li><input disabled="" type="checkbox"> è½¯ä»¶å®šä¹‰ç½‘ç»œï¼ˆSDNï¼‰</li><li><input disabled="" type="checkbox"> æ„å›¾é©±åŠ¨ç½‘ç»œï¼ˆIDNï¼‰</li></ul></li></ul></li></ul><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹ç¬¬ä¸€éƒ¨åˆ†ï¼Œä»æœ€ç›´è§‚ã€æœ€æ ¹æœ¬çš„å±‚é¢ç†è§£è·¯ç”±çš„æ ¸å¿ƒæ€æƒ³ã€‚</p><hr><h3 id="ç¬¬ä¸€éƒ¨åˆ†ï¼šè·¯ç”±çš„æ ¸å¿ƒæ€æƒ³ä¸ç°å®ç±»æ¯”"><a href="#ç¬¬ä¸€éƒ¨åˆ†ï¼šè·¯ç”±çš„æ ¸å¿ƒæ€æƒ³ä¸ç°å®ç±»æ¯”" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ†ï¼šè·¯ç”±çš„æ ¸å¿ƒæ€æƒ³ä¸ç°å®ç±»æ¯”"></a><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼šè·¯ç”±çš„æ ¸å¿ƒæ€æƒ³ä¸ç°å®ç±»æ¯”</strong></h3><h4 id="å¼€åœº-SCQA-Why"><a href="#å¼€åœº-SCQA-Why" class="headerlink" title="å¼€åœº (SCQA + Why)"></a><strong>å¼€åœº (SCQA + Why)</strong></h4><ul><li><strong>(S) æƒ…å¢ƒ (Situation):</strong> åœ¨æˆ‘ä»¬çš„æ•°å­—ä¸–ç•Œï¼ˆå‘é€é‚®ä»¶ã€æµè§ˆç½‘é¡µï¼‰å’Œç°å®ä¸–ç•Œï¼ˆå¯„å¿«é€’ã€å¼€è½¦å‡ºè¡Œï¼‰ä¸­ï¼Œä¿¡æ¯å’Œç‰©ä½“æ— æ—¶æ— åˆ»ä¸åœ¨ä»ä¸€ä¸ªåœ°æ–¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚</li><li><strong>(C) å†²çª (Complication):</strong> ä½†å®ƒä»¬å¹¶ä¸çŸ¥é“å¦‚ä½•ä»èµ·ç‚¹Aè‡ªåŠ¨åˆ°è¾¾é¥è¿œçš„ç»ˆç‚¹Bã€‚ä¸€ä¸ªæ•°æ®åŒ…ç¦»å¼€ä½ çš„ç”µè„‘æ—¶ï¼Œå®ƒå¯¹å…¨çƒäº’è”ç½‘çš„å¤æ‚ç»“æ„ä¸€æ— æ‰€çŸ¥ï¼›ä¸€ä¸ªå¿«é€’åŒ…è£¹ç¦»å¼€ä½ å®¶æ—¶ï¼Œå®ƒä¹Ÿä¸çŸ¥é“å¦‚ä½•ç©¿è¶Šå¤§åŠä¸ªå›½å®¶åˆ°è¾¾æ”¶ä»¶äººæ‰‹ä¸­ã€‚</li><li><strong>(Q) é—®é¢˜ (Question):</strong> é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•ä¸ºè¿™äº›ä¿¡æ¯æˆ–ç‰©ä½“è§„åˆ’å‡ºä¸€æ¡é«˜æ•ˆã€å¯é çš„è·¯å¾„ï¼Œå¼•å¯¼å®ƒä»¬ä¸€æ­¥æ­¥èµ°å‘æœ€ç»ˆç›®çš„åœ°å‘¢ï¼Ÿ</li><li><strong>(A) å›ç­” (Answer):</strong> è¿™å°±æ˜¯â€œè·¯ç”±â€è¦è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€‚<strong>è·¯ç”±ï¼ˆRoutingï¼‰</strong>çš„æœ¬è´¨ï¼Œå°±æ˜¯<strong>ä¸ºæ•°æ®æˆ–ç‰©ä½“åœ¨ç½‘ç»œä¸­é€‰æ‹©è·¯å¾„çš„è¿‡ç¨‹</strong>ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å…ˆä¸è°ˆå¤æ‚çš„ä»£ç å’Œåè®®ï¼Œè€Œæ˜¯é€šè¿‡ç”Ÿæ´»ä¸­ç†Ÿæ‚‰çš„ä¾‹å­ï¼Œæ¥æ„å»ºå¯¹è·¯ç”±æœ€æ ¸å¿ƒã€æœ€ç‰¢å›ºçš„ç†è§£ã€‚</li></ul><h4 id="æ–¹æ¡ˆä»‹ç»-How-ç±»æ¯”"><a href="#æ–¹æ¡ˆä»‹ç»-How-ç±»æ¯”" class="headerlink" title="æ–¹æ¡ˆä»‹ç» (How + ç±»æ¯”)"></a><strong>æ–¹æ¡ˆä»‹ç» (How + ç±»æ¯”)</strong></h4><p><strong>ï¼ˆç»™åœ°å›¾ï¼‰</strong> ä¸ºäº†ç†è§£è·¯ç”±ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ‹†è§£æˆä¸‰ä¸ªæˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„ç°å®ä¸–ç•Œæ¡ˆä¾‹ã€‚è¿™ä¸‰ä¸ªæ¡ˆä¾‹å°±åƒä¸‰ç§ä¸åŒçš„â€œæ¡ˆä¾‹ç‰‡æ®µâ€ï¼Œåˆ†åˆ«æ­ç¤ºäº†è·¯ç”±çš„ä¸€ä¸ªä¾§é¢ã€‚</p><p><strong>ï¼ˆè®²ç»†èŠ‚+ç”¨ç±»æ¯”ï¼‰</strong></p><ol><li><p><strong>æ¡ˆä¾‹ä¸€ï¼šè¡—å¤´é—®è·¯ (æ­ç¤ºäº†â€œä¸‹ä¸€è·³â€çš„æ¦‚å¿µ)</strong></p><ul><li><strong>åœºæ™¯ï¼š</strong> ä½ åœ¨ä¸€ä¸ªé™Œç”Ÿçš„åŸå¸‚ï¼Œè¦å»ä¸€ä¸ªè‘—åæ™¯ç‚¹ã€‚ä½ ä¸çŸ¥é“å®Œæ•´è·¯çº¿ï¼Œä½†ä½ çœ‹åˆ°ä¸€ä¸ªè­¦å¯Ÿã€‚</li><li><strong>ä½ çš„è¡Œä¸ºï¼š</strong> ä½ é—®è­¦å¯Ÿï¼šâ€œä½ å¥½ï¼Œè¯·é—®å»XXæ™¯ç‚¹æ€ä¹ˆèµ°ï¼Ÿâ€</li><li><strong>è­¦å¯Ÿçš„å›ç­”ï¼š</strong> ä»–ä¸ä¼šå‘Šè¯‰ä½ ä»å½“å‰ä½ç½®åˆ°æ™¯ç‚¹çš„æ¯ä¸€æ­¥ã€‚ä»–ä¼šè¯´ï¼šâ€œå“¦ï¼Œä½ <strong>æ²¿ç€è¿™æ¡è·¯ç›´èµ°ï¼Œåˆ°ä¸‹ä¸€ä¸ªè·¯å£å·¦è½¬</strong>ï¼Œå°±èƒ½çœ‹åˆ°åœ°é“ç«™äº†ï¼Œååœ°é“3å·çº¿å°±èƒ½åˆ°ã€‚â€</li><li><strong>æ ¸å¿ƒæ´å¯Ÿï¼š</strong> è¿™ä¸ªè­¦å¯Ÿå°±æ˜¯ä¸€ä¸ªâ€œè·¯ç”±å™¨â€ã€‚ä»–ä¸éœ€è¦çŸ¥é“å…¨ç¨‹ï¼Œä»–åªéœ€è¦æ ¹æ®ä½ çš„â€œç›®çš„åœ°â€ï¼ˆæ™¯ç‚¹ï¼‰ï¼Œä¸ºä½ æŒ‡å‡º**â€œä¸‹ä¸€è·³â€ (Next Hop)**â€”â€”ä¹Ÿå°±æ˜¯ä½ ä¸‹ä¸€æ­¥åº”è¯¥å»çš„åœ°æ–¹ï¼ˆè·¯å£å·¦è½¬çš„åœ°é“ç«™ï¼‰ã€‚ä½ åˆ°è¾¾ä¸‹ä¸€è·³åï¼Œå†å¯»æ‰¾æ–°çš„æŒ‡å¼•ã€‚äº’è”ç½‘ä¸Šçš„è·¯ç”±å™¨å°±æ˜¯è¿™æ ·å·¥ä½œçš„ï¼Œå®ƒä»¬æ¥åŠ›å¼åœ°æŠŠæ•°æ®åŒ…ä¸€è·³ä¸€è·³åœ°ä¼ å‘ç›®çš„åœ°ã€‚</li></ul></li><li><p><strong>æ¡ˆä¾‹äºŒï¼šé‚®æ”¿å¿«é€’ç³»ç»Ÿ (æ­ç¤ºäº†â€œåˆ†å±‚â€ä¸â€œåœ°å€â€çš„æ¦‚å¿µ)</strong></p><ul><li><strong>åœºæ™¯ï¼š</strong> ä½ ä»åŒ—äº¬å¯„ä¸€ä¸ªå¿«é€’åˆ°æ·±åœ³å—å±±åŒºçš„ä¸€ä¸ªå…·ä½“åœ°å€ã€‚</li><li><strong>è¿‡ç¨‹ï¼š</strong><ul><li>ä½ æŠŠåŒ…è£¹äº¤ç»™å®¶é—¨å£çš„å¿«é€’å‘˜ã€‚ä»–ä¸éœ€è¦çŸ¥é“å»æ·±åœ³çš„å…·ä½“è·¯çº¿ï¼Œä»–åªéœ€è¦æŠŠåŒ…è£¹é€åˆ°<strong>æœ¬åœ°åˆ†æ‹£ä¸­å¿ƒ</strong>ã€‚</li><li>æœ¬åœ°åˆ†æ‹£ä¸­å¿ƒçœ‹åˆ°â€œæ·±åœ³å¸‚â€ï¼Œå°±æŠŠåŒ…è£¹å‘å¾€<strong>åŒ—äº¬çš„åŒºåŸŸæ¢çº½</strong>ã€‚</li><li>åŒ—äº¬æ¢çº½å°†æ‰€æœ‰å‘å¾€åå—çš„åŒ…è£¹é›†ä¸­èµ·æ¥ï¼Œé€šè¿‡é£æœºæˆ–é«˜é“å‘å¾€<strong>æ·±åœ³çš„åŒºåŸŸæ¢çº½</strong>ã€‚</li><li>æ·±åœ³æ¢çº½çœ‹åˆ°â€œå—å±±åŒºâ€ï¼Œå°±æŠŠå®ƒå‘å¾€<strong>å—å±±åŒºçš„åˆ†æ‹£ä¸­å¿ƒ</strong>ã€‚</li><li>æœ€ç»ˆï¼Œå—å±±çš„å¿«é€’å‘˜æ‰çœ‹åˆ°å®Œæ•´çš„è¡—é“é—¨ç‰Œå·ï¼Œå¹¶é€åˆ°æ”¶ä»¶äººæ‰‹ä¸­ã€‚</li></ul></li><li><strong>æ ¸å¿ƒæ´å¯Ÿï¼š</strong> è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„<strong>åˆ†å±‚è·¯ç”±ç³»ç»Ÿ</strong>ã€‚æ¯ä¸€å±‚çš„â€œè·¯ç”±å™¨â€ï¼ˆå¿«é€’å‘˜ã€åˆ†æ‹£ä¸­å¿ƒã€æ¢çº½ï¼‰åªå…³å¿ƒè‡ªå·±è¿™ä¸€å±‚çº§çš„ä»»åŠ¡ã€‚è¿™ä¸ªç³»ç»Ÿä¾èµ–ä¸€ä¸ªç»“æ„åŒ–çš„â€œåœ°å€â€ï¼ˆå›½å®¶-çœ-å¸‚-åŒº-è¡—é“-é—¨ç‰Œï¼‰æ¥å·¥ä½œã€‚IPåœ°å€çš„è®¾è®¡ä¹Ÿéµå¾ªäº†ç±»ä¼¼çš„ç½‘ç»œå·å’Œä¸»æœºå·çš„å±‚çº§ç»“æ„ã€‚</li></ul></li><li><p><strong>æ¡ˆä¾‹ä¸‰ï¼šé«˜é€Ÿå…¬è·¯å¯¼èˆª (æ­ç¤ºäº†â€œåŠ¨æ€â€ä¸â€œåº¦é‡â€çš„æ¦‚å¿µ)</strong></p><ul><li><strong>åœºæ™¯ï¼š</strong> ä½ å¼€è½¦ä»Aå¸‚åˆ°Bå¸‚ï¼Œæ‰“å¼€äº†åœ°å›¾Appã€‚</li><li><strong>Appçš„è¡Œä¸ºï¼š</strong> å¯¼èˆªAppä¼šç»™ä½ å‡ æ¡è·¯çº¿é€‰æ‹©ï¼š<ul><li>è·¯çº¿1ï¼šè·ç¦»æœ€çŸ­ï¼Œä½†å¯èƒ½ç»è¿‡å¸‚åŒºï¼Œçº¢ç»¿ç¯å¤šã€‚</li><li>è·¯çº¿2ï¼šæ—¶é—´æœ€å¿«ï¼Œå…¨ç¨‹é«˜é€Ÿï¼Œä½†è·¯ç¨‹æ›´é•¿ï¼Œè´¹ç”¨æ›´é«˜ã€‚</li><li>è·¯çº¿3ï¼šèº²é¿æ‹¥å µï¼Œè¿™æ˜¯Appæ ¹æ®<strong>å®æ—¶è·¯å†µ</strong>åŠ¨æ€è®¡ç®—å‡ºæ¥çš„ã€‚</li></ul></li><li><strong>æ ¸å¿ƒæ´å¯Ÿï¼š</strong> è¿™é‡Œçš„â€œæœ€ä½³è·¯å¾„â€ä¸æ˜¯å”¯ä¸€çš„ï¼Œå®ƒå–å†³äºä½ çš„<strong>åº¦é‡æ ‡å‡†ï¼ˆMetricï¼‰</strong>â€”â€”æ˜¯æ—¶é—´ã€è·ç¦»è¿˜æ˜¯è´¹ç”¨ï¼Ÿè€Œä¸”ï¼Œè¿™ä¸ªæœ€ä½³è·¯å¾„æ˜¯<strong>åŠ¨æ€å˜åŒ–</strong>çš„ã€‚å¦‚æœå‰æ–¹å‘ç”Ÿäº‹æ•…ï¼Œå¯¼èˆªä¼šç«‹åˆ»ä¸ºä½ é‡æ–°è§„åˆ’è·¯çº¿ã€‚åœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼ŒåŠ¨æ€è·¯ç”±åè®®å°±åƒä¸€ä¸ªé«˜çº§çš„å¯¼èˆªç³»ç»Ÿï¼Œä¼šæ ¹æ®ç½‘ç»œæ‹¥å µã€é“¾è·¯æ•…éšœç­‰æƒ…å†µï¼ŒåŠ¨æ€åœ°è°ƒæ•´æ•°æ®åŒ…çš„ä¼ è¾“è·¯å¾„ã€‚</li></ul></li></ol><h4 id="æˆæœå±•ç¤º-What-å¯è§†åŒ–"><a href="#æˆæœå±•ç¤º-What-å¯è§†åŒ–" class="headerlink" title="æˆæœå±•ç¤º (What + å¯è§†åŒ–)"></a><strong>æˆæœå±•ç¤º (What + å¯è§†åŒ–)</strong></h4><p>é€šè¿‡è¿™ä¸‰ä¸ªç±»æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºè·¯ç”±çš„æ ¸å¿ƒå·¥ä½œé€»è¾‘ã€‚å®ƒä¸æ–­åœ°åœ¨é—®ä¸‰ä¸ªé—®é¢˜ï¼š</p><ol><li><strong>æˆ‘åœ¨å“ªï¼Ÿ</strong> (æ•°æ®åŒ…å½“å‰æ‰€åœ¨çš„è·¯ç”±å™¨)</li><li><strong>æˆ‘è¦å»å“ªï¼Ÿ</strong> (æ•°æ®åŒ…çš„ç›®çš„åœ°åœ°å€)</li><li><strong>æ€ä¹ˆèµ°æœ€é«˜æ•ˆï¼Ÿ</strong> (æ ¹æ®è·¯ç”±è¡¨æˆ–ç®—æ³•ï¼Œè®¡ç®—å‡ºä¸‹ä¸€è·³)</li></ol><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„æµç¨‹å›¾æ¥å¯è§†åŒ–è¿™ä¸ªè¿‡ç¨‹ï¼š</p><p><img src="https://bu.dusays.com/2025/08/19/68a4280d97a9a.png" alt="è·¯ç”±å·¥ä½œæµç¨‹å›¾"></p><blockquote><p>â­<strong>çŸ¥è¯†ç‚¹ï¼šä¸‹ä¸€è·³ (Next Hop)</strong></p><p>è¿™æ˜¯è·¯ç”±ä¸­æœ€é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚æ²¡æœ‰ä»»ä½•ä¸€ä¸ªè·¯ç”±å™¨éœ€è¦çŸ¥é“åˆ°è¾¾ç›®çš„åœ°çš„å®Œæ•´è·¯å¾„ã€‚å®ƒåªéœ€è¦çŸ¥é“ï¼Œä¸ºäº†åˆ°è¾¾é‚£ä¸ªæœ€ç»ˆç›®çš„åœ°ï¼Œ<strong>ä¸‹ä¸€æ­¥åº”è¯¥æŠŠè¿™ä¸ªæ•°æ®åŒ…äº¤ç»™è°</strong>ã€‚è¿™ä¸ªâ€œè°â€å°±æ˜¯ä¸‹ä¸€è·³ã€‚æ­£æ˜¯è¿™ç§â€œåªç®¡ä¸‹ä¸€æ­¥â€çš„æ¥åŠ›æœºåˆ¶ï¼Œä½¿å¾—åƒäº’è”ç½‘è¿™æ ·åºå¤§å¤æ‚çš„ç½‘ç»œèƒ½å¤Ÿé«˜æ•ˆè¿è½¬ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è·¯ç”± </tag>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
